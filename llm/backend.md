# ü¶Ä Backend (Rust) - Secure Message

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Backend

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Rust**: –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **Actix-web**: Web —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Tokio**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Serde**: –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON
- **File System**: –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
back/
‚îú‚îÄ‚îÄ Cargo.toml              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.rs            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ modules/           # –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs         # –≠–∫—Å–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/           # HTTP API endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ host_dist/     # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ my_events/     # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îî‚îÄ‚îÄ mod.rs
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### main.rs - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```rust
// –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CORS
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
```

### modules/api/ - HTTP API
```rust
// REST endpoints –¥–ª—è:
// - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
// - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
// - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
// - WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```

### modules/host_dist/ - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
```rust
// –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ frontend —Ñ–∞–π–ª–æ–≤
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏
// Gzip —Å–∂–∞—Ç–∏–µ
```

### modules/my_events/ - –°–æ–±—ã—Ç–∏—è
```rust
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç event-stream
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

## üåê API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```
POST /api/auth/login
POST /api/auth/register
POST /api/auth/logout
GET  /api/auth/profile
```

### –§–∞–π–ª—ã
```
POST /api/files/upload
GET  /api/files/:id
DELETE /api/files/:id
GET  /api/files/list
```

### –°–æ–±—ã—Ç–∏—è
```
POST /api/events/send
GET  /api/events/history
WebSocket /ws/events
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- JWT —Ç–æ–∫–µ–Ω—ã
- Bcrypt –¥–ª—è –ø–∞—Ä–æ–ª–µ–π
- Session management

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- Role-based access control
- Resource ownership validation
- Rate limiting

### –§–∞–π–ª–æ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤
- Sandbox –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫

## üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### File System —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
data/
‚îú‚îÄ‚îÄ uploads/           # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ documents/
‚îÇ   ‚îî‚îÄ‚îÄ temp/
‚îú‚îÄ‚îÄ logs/             # –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ cache/            # –ö—ç—à –¥–∞–Ω–Ω—ã—Ö
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
```rust
// –ó–∞–≥—Ä—É–∑–∫–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
async fn upload_file(payload: Multipart) -> Result<FileInfo>

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
async fn get_file(file_id: String) -> Result<FileStream>

// –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
async fn delete_file(file_id: String) -> Result<()>
```

## üîÑ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### Frontend ‚Üî Backend
```rust
// HTTP API –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
// WebSocket –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
// File upload/download
// CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è dev/prod
```

### Backend ‚Üî Event-Stream
```rust
// HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π
// –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Development
```bash
cd back
cargo run
# –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ http://localhost:8080
```

### Production
```bash
# –°–±–æ—Ä–∫–∞ release –≤–µ—Ä—Å–∏–∏
cargo build --release

# Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker build -t secure-message-backend .
docker run -p 8080:8080 secure-message-backend
```

### Environment Variables
```bash
# –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞
PORT=8080

# –ü—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º
DATA_PATH=./data

# Event-stream URL
EVENT_STREAM_URL=http://localhost:3000

# JWT —Å–µ–∫—Ä–µ—Ç
JWT_SECRET=your-secret-key

# CORS origins
CORS_ORIGINS=http://localhost:5173
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```rust
// –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
log::info!("Server started on port {}", port);
log::error!("Failed to process request: {}", error);

// –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª—ã
// –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
// –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –ú–µ—Ç—Ä–∏–∫–∏
```rust
// –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
// –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
```

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
- –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –≤ long-running –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting
- –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø–æ—Ä—Ç–æ–≤

## üéØ Best Practices

### –ö–æ–¥
```rust
// –ò—Å–ø–æ–ª—å–∑—É–π Result<T, E> –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
// –ò–∑–±–µ–≥–∞–π unwrap() –≤ production –∫–æ–¥–µ
// –ü—Ä–∏–º–µ–Ω—è–π async/await –ø—Ä–∞–≤–∏–ª—å–Ω–æ
// –í–∞–ª–∏–¥–∏—Ä—É–π –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```rust
// –†–∞–∑–¥–µ–ª—è–π –ª–æ–≥–∏–∫—É –ø–æ –º–æ–¥—É–ª—è–º
// –ò—Å–ø–æ–ª—å–∑—É–π dependency injection
// –ü—Ä–∏–º–µ–Ω—è–π –ø–∞—Ç—Ç–µ—Ä–Ω Repository
// –¢–µ—Å—Ç–∏—Ä—É–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```rust
// –í—Å–µ–≥–¥–∞ –≤–∞–ª–∏–¥–∏—Ä—É–π –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
// –ò—Å–ø–æ–ª—å–∑—É–π prepared statements
// –õ–æ–≥–∏—Ä—É–π –≤—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
// –ü—Ä–∏–º–µ–Ω—è–π –ø—Ä–∏–Ω—Ü–∏–ø least privilege
```

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
cargo check

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
cargo test

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
cargo fmt

# –õ–∏–Ω—Ç–∏–Ω–≥
cargo clippy

# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
cargo doc --open

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cargo update
```

## üìö –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Cargo.toml)

```toml
[dependencies]
actix-web = "4.0"
tokio = { version = "1.0", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
uuid = { version = "1.0", features = ["v4"] }
chrono = { version = "0.4", features = ["serde"] }
env_logger = "0.10"
log = "0.4"
