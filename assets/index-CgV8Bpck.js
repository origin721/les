import{ad as o,ae as n,as as i,x as d,aw as c}from"./index-bOy5Y-zK.js";const f={async getList(){return await o.fetch({path:n.GET_FRIENDS})},async getByAccountId(e){return await o.fetch({path:n.GET_FRIENDS_BY_ACCOUNT_ID,body:{myAccId:e}})},async getById(e){return await o.fetch({path:n.GET_FRIEND_BY_ID,body:{friendId:e}})},async add(e){i("ðŸŒ API friends.add Ð¡Ð¢ÐÐ Ð¢:",e);const r=Date.now();try{let t;Array.isArray(e)?(t={path:n.ADD_FRIENDS,body:{list:e}},i("ðŸŒ API friends.add: Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ (Ð¼Ð°ÑÑÐ¸Ð²)")):(t={path:n.ADD_FRIENDS,body:{list:e.friends,myAccId:e.myAccId}},i("ðŸŒ API friends.add: Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ñ myAccId:",e.myAccId)),i("ðŸŒ API friends.add: Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ shared_worker_store.fetch Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸:",t);const u=await o.fetch(t);return i("âœ… API friends.add Ð£Ð¡ÐŸÐ•Ð¥ Ð·Ð°",Date.now()-r,"Ð¼Ñ, Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:",u),u}catch(t){throw d("âŒ API friends.add ÐžÐ¨Ð˜Ð‘ÐšÐ Ð·Ð°",Date.now()-r,"Ð¼Ñ:",t),i("âŒ API friends.add Ð¿Ð¾Ð»Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°:",t==null?void 0:t.stack),t}},async delete(e){await o.fetch({path:n.DELETE_FRIENDS,body:{ids:e}})},async put(e){await o.fetch({path:n.PUT_FRIENDS,body:{list:e}})}},y={async login(e){await o.fetch({path:n.LOGIN,body:{pass:e}})},async getList(){return await o.fetch({path:n.GET_ACCOUNTS})}},A={subscribeActiveTabsCount(e){return c("tabs.subscribeActiveTabsCount Ð’Ð«Ð—ÐžÐ’"),o.subscribeToWorker({payload:{path:n.GET_ACTIVE_TABS_COUNT},callback:r=>{c("tabs.subscribeActiveTabsCount Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ðµ:",r),e(r.count)}})},createReactiveTabsCounter(){c("tabs.createReactiveTabsCounter Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð•");let e=0,r=!1,t=[],u=null;const T=a=>{r!==a&&(r=a,c("tabs.createReactiveTabsCounter Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:",a),t.forEach(s=>{try{s(a)}catch(b){d("tabs.createReactiveTabsCounter Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² callback Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:",b)}}))},h=a=>{u&&(c("tabs.createReactiveTabsCounter Ð¿ÐµÑ€ÐµÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸"),u()),u=o.subscribeToWorker({payload:{path:n.GET_ACTIVE_TABS_COUNT},callback:s=>{if(c("tabs.createReactiveTabsCounter Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ðµ:",s),e=s.count,T(!0),a)try{a(s.count)}catch(b){d("tabs.createReactiveTabsCounter Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² callback:",b)}}}),setTimeout(()=>{r||(c("tabs.createReactiveTabsCounter Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ, Ð¿Ð¾Ð¼ÐµÑ‡Ð°ÐµÐ¼ ÐºÐ°Ðº Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½"),T(!1))},5e3)};return{subscribe:a=>(c("tabs.createReactiveTabsCounter.subscribe Ð’Ð«Ð—ÐžÐ’"),h(a),()=>{c("tabs.createReactiveTabsCounter.subscribe ÐžÐ¢ÐŸÐ˜Ð¡ÐšÐ"),u&&(u(),u=null),T(!1)}),getCurrentCount:async()=>(c("tabs.createReactiveTabsCounter.getCurrentCount Ð’Ð«Ð—ÐžÐ’, Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:",e),r?e:new Promise((a,s)=>{const b=setTimeout(()=>{s(new Error("Timeout: Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð²ÐºÐ»Ð°Ð´Ð¾Ðº"))},3e3),l=o.subscribeToWorker({payload:{path:n.GET_ACTIVE_TABS_COUNT},callback:C=>{clearTimeout(b),l(),e=C.count,a(C.count)}})})),isConnected:()=>r,onConnectionChange:a=>{c("tabs.createReactiveTabsCounter.onConnectionChange ÐŸÐžÐ”ÐŸÐ˜Ð¡ÐšÐ"),t.push(a);try{a(r)}catch(s){d("tabs.createReactiveTabsCounter.onConnectionChange Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² callback:",s)}return()=>{c("tabs.createReactiveTabsCounter.onConnectionChange ÐžÐ¢ÐŸÐ˜Ð¡ÐšÐ");const s=t.indexOf(a);s>-1&&t.splice(s,1)}}}}},_={friends:f,accounts:y,tabs:A};export{_ as s};
