import{I as t,M as d,K as a}from"./index-CPioufBD.js";import{d as D,e as h}from"./decrypt_curve25519_from_pass-CBE2Th_U.js";const w={version:4,name:"accounts_room_ids",description:"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è roomIds –∫ accounts",fileName:"4_accounts_room_ids.ts"};function A(u){t("üì¶ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é —Å—Ö–µ–º—ã 4: –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π"),t("‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã 4 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")}async function S(u){const{db:_,currentUser:e}=u;return t(`üîÑ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö 4 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${e.id}`),new Promise((p,s)=>{try{const o=_.transaction(["accounts"],"readwrite"),m=o.objectStore("accounts"),c=m.getAll();c.onsuccess=async function(){try{const r=c.result;if(r.length===0){t("‚úÖ –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π accounts –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏"),p();return}t(`üìã –ù–∞–π–¥–µ–Ω–æ ${r.length} –∑–∞–ø–∏—Å–µ–π accounts`);let f=0;for(const n of r){d(`üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–∏—Å—å account ${n.id}`);const g=await D({pass:e.pass,cipherText:n.data});if(!g){a(`üí• –ü–û–í–†–ï–ñ–î–ï–ù–ù–´–ï –î–ê–ù–ù–´–ï: account ${n.id}`);continue}const i=JSON.parse(g);if(i.version>=2){d(`‚è≠Ô∏è –ó–∞–ø–∏—Å—å account ${n.id} —É–∂–µ –∏–º–µ–µ—Ç –≤–µ—Ä—Å–∏—é ${i.version}`);continue}const l={...i,roomIds:[],version:2,date_updated:new Date},y=await h({pass:e.pass,message:JSON.stringify(l)}),$={id:n.id,data:y};m.put($),f++,d(`‚úÖ –ó–∞–ø–∏—Å—å account ${n.id} –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å roomIds`)}o.oncomplete=function(){t("‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö 4 –∑–∞–≤–µ—Ä—à–µ–Ω–∞"),t(`üìä –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${f} accounts`),p()},o.onerror=function(){a("‚ùå –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:",o.error),s(o.error)}}catch(r){a("‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:",r),s(r)}},c.onerror=function(){a("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ accounts:",c.error),s(c.error)}}catch(o){a("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ migrationData:",o),s(o)}})}export{S as migrationData,w as migrationInfo,A as migrationScheme};
