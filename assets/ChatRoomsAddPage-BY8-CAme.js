import{w as v,N as O,v as b,d as R,O as I,f as S,i as w,L as A,z as M,a as g,R as y,J as k,r as x,m as l,e as j,P as C,g as T,h as U,c as p,Q as D,u as E,S as H,U as L,V as N,M as P}from"./index-B6ZDc0Es.js";const Q=z();function z(){const t=v(J());function a(r){const s=b();return t.update(e=>{const _={...e.rooms,[s]:{name:r.name,room_id:s,messages:{}}};return{...e,rooms:_}}),{roomId:s}}const m=r=>{const s=b();t.update(e=>({...e,rooms:{...e.rooms,[r.roomId]:{...e.rooms[r.roomId],messages:{...e.rooms[r.roomId].messages,[s]:{text:r.message,created_date:new Date}}}}}))};function n(r){t.update(s=>{try{let e={...s,my_ids_for_server:s.my_ids_for_server||{}};return e.my_ids_for_server={...e.my_ids_for_server},delete e.my_ids_for_server[r.user_id],e}catch(e){return console.error(import.meta.url,e),s}})}function o(r){t.update(s=>{try{let e={...s,my_ids_for_server:s.my_ids_for_server||{}};return e.my_ids_for_server={...e.my_ids_for_server,[r.user_id]:r.user_id},e}catch(e){return console.error(import.meta.url,e),s}})}return{subscribe:t.subscribe,add_message:m,add_room:a,get_room_by_id:r=>Object.values(O(t).rooms).find(s=>s.room_id===r)||null,registration_by_id:o,delete_registration_by_id:n}}function J(){return{rooms:{},my_ids_for_server:{}}}function V(t,a,m,n){const o=Q.add_room({name:a()||n});E.setPath(`${y.CHAT_ROOMS}?${H({[L.ROOM_ID]:o.roomId})}`)}var Y=S('<!> <form><label><span>Имя комнаты</span> <input/></label> <button type="submit">Создать</button></form>',1);function B(t,a){R(a,!1);const[m,n]=U(),o=()=>x(s,"$name_field",m),r="no name";let s=v("");I();var e=Y(),_=w(e);A(_,{get href(){return y.CHAT_ROOMS},children:(i,u)=>{var $=M("back");g(i,$)},$$slots:{default:!0}});var d=l(_,2),c=p(d),f=l(p(c),2);k(f,"placeholder",r);var h=l(c,2);h.__click=[V,o,s,r],j("submit",d,function(...i){var u;(u=N)==null||u.apply(this,i)}),C(f,o,i=>D(s,i)),g(t,e),T(),n()}P(["click"]);export{B as default};
