const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/-1_tmp_test-BlnaWVRx.js","assets/index-bOy5Y-zK.js","assets/index-DRuqfa8t.css","assets/0_initialization-CS_rwdlJ.js","assets/1_accounts_friends-BsEYL5H7.js","assets/decrypt_curve25519_from_pass-Cw2vtp8e.js","assets/2_accounts_versioning-DH1u-_Hl.js","assets/3_rooms_versioning-mEFb9adH.js","assets/4_accounts_room_ids-B6I0sC9g.js"])))=>i.map(i=>d[i]);
var as=Object.defineProperty;var is=(s,t,e)=>t in s?as(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var er=(s,t,e)=>is(s,typeof t!="symbol"?t+"":t,e);import{x as y,y as v,z as cr,_ as P,A as cs,p as ye,f as O,B as st,m as g,t as M,a as A,c as l,C as b,D as u,b as d,d as dr,E as lr,G as we,g as ur,h as vr,H as q,I as ds,J as z,r as De,l as f,K as rt,L as $e,M as ls,N as gr,O as us,j as x,P as K,Q as rr,R as sr,T as or,q as vs,i as nr,S as gs}from"./index-bOy5Y-zK.js";import{B as _s}from"./BasePage-BR7agg88.js";import{s as ms}from"./index-CgV8Bpck.js";const _r=(s,t,e)=>{const r=s[t];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((o,n)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==e?". Note that variables only represent file names one level deep.":""))))})},_t={0:"0_initialization",1:"1_accounts_friends",2:"2_accounts_versioning",3:"3_rooms_versioning",4:"4_accounts_room_ids"},ar=0,Ut={MAIN_LES_STORE_V1:"main_les_store_v1",DB_STATE_MANAGER_V1:"db_state_manager_v1"},ot={IDLE:"idle",UPDATE_STARTED:"update_started",UPDATE_SUCCESS:"update_success",UPDATE_FAILED:"update_failed",CORRUPTED:"corrupted"},fs=1;function be(){return new Promise((s,t)=>{const e=indexedDB.open(Ut.DB_STATE_MANAGER_V1,fs);e.onupgradeneeded=r=>{const o=e.result;o.objectStoreNames.contains("db_states")||(o.createObjectStore("db_states",{keyPath:"id"}),v("‚úÖ –°–æ–∑–¥–∞–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ db_states"))},e.onsuccess=()=>{s(e.result)},e.onerror=()=>{y("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –±–∞–∑—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π:",e.error),t(e.error)}})}async function F(s){try{const t=await be();return new Promise((e,r)=>{const o=t.transaction(["db_states"],"readonly"),a=o.objectStore("db_states").get(s);a.onsuccess=()=>{e(a.result||null)},a.onerror=()=>{r(a.error)},o.oncomplete=()=>{t.close()}})}catch(t){return y("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î:",t),null}}async function yt(s){try{const t=await be();return new Promise((e,r)=>{const o=t.transaction(["db_states"],"readwrite"),n=o.objectStore("db_states");s.lastUpdated=Date.now();const a=n.put(s);a.onsuccess=()=>{v("‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î –æ–±–Ω–æ–≤–ª–µ–Ω–æ:",{dbName:s.dbName,version:s.version,status:s.status}),e()},a.onerror=()=>{y("‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î:",a.error),r(a.error)},o.oncomplete=()=>{t.close()}})}catch(t){throw y("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î:",t),t}}async function St(s,t,e,r,o){try{let n=await F(s);n?(n.status=t,e!==void 0&&(n.version=e),r!==void 0&&(n.targetVersion=r),o!==void 0&&(n.errorMessage=o)):n={id:s,dbName:s,version:e||0,status:t,lastUpdated:Date.now()},await yt(n)}catch(n){throw y("‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:",n),n}}async function mr(s){const t=await F(s);return(t==null?void 0:t.version)||0}async function fr(s){const t=await F(s);return t?t.status!==ot.UPDATE_STARTED:!0}async function Rt(){try{const s=await be();return new Promise((t,e)=>{const r=s.transaction(["db_states"],"readonly"),n=r.objectStore("db_states").getAll();n.onsuccess=()=>{t(n.result)},n.onerror=()=>{e(n.error)},r.oncomplete=()=>{s.close()}})}catch(s){return y("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –ë–î:",s),[]}}async function hr(s,t,e){try{let r=await F(s);r||(r={id:s,dbName:s,version:t,status:ot.UPDATE_STARTED,lastUpdated:Date.now()}),r.migrationStartTime=Date.now(),r.targetVersion=e,r.executedMigrations=[],r.migratedTables=[],await yt(r),v("‚è±Ô∏è –ù–∞—á–∞—Ç —Ç–∞–π–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏:",{dbName:s,fromVersion:t,toVersion:e})}catch(r){throw y("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –Ω–∞—á–∞–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:",r),r}}async function pr(s){try{const t=await F(s);if(!t||!t.migrationStartTime){y("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∞—á–∞–ª–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏:",s);return}const e=Date.now();t.migrationEndTime=e,t.migrationDurationMs=e-t.migrationStartTime,await yt(t),v("‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω —Ç–∞–π–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏:",{dbName:s,durationMs:t.migrationDurationMs,durationSec:Math.round(t.migrationDurationMs/1e3)})}catch(t){throw y("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:",t),t}}async function ut(s){try{const t=await F(s);if(!t||t.status!==ot.UPDATE_STARTED)return!1;const e=10*60*1e3,r=Date.now(),o=t.migrationStartTime?r-t.migrationStartTime:r-t.lastUpdated,n=o>e;return n&&v("‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∑–∞–≤–∏—Å—à–∞—è –º–∏–≥—Ä–∞—Ü–∏—è:",{dbName:s,ageMinutes:Math.round(o/6e4),lastUpdated:new Date(t.lastUpdated).toISOString()}),n}catch(t){return y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π:",t),!1}}async function vt(s){try{const t=await F(s);if(!t){v("‚ÑπÔ∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, —Å–±—Ä–æ—Å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:",s);return}t.status=ot.IDLE,t.errorMessage="–ú–∏–≥—Ä–∞—Ü–∏—è –±—ã–ª–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∏–∑-–∑–∞ –∑–∞–≤–∏—Å–∞–Ω–∏—è",delete t.migrationStartTime,delete t.migrationEndTime,delete t.migrationDurationMs,delete t.targetVersion,await yt(t),v("üîÑ –°–±—Ä–æ—à–µ–Ω–∞ –∑–∞–≤–∏—Å—à–∞—è –º–∏–≥—Ä–∞—Ü–∏—è:",s)}catch(t){throw y("‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –∑–∞–≤–∏—Å—à–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏:",t),t}}async function Sr(s){try{const t=await F(s);return t?{totalDuration:t.migrationDurationMs||0,lastMigrationDate:t.migrationEndTime?new Date(t.migrationEndTime):null,executedMigrations:t.executedMigrations||[]}:{totalDuration:0,lastMigrationDate:null,executedMigrations:[]}}catch(t){return y("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π:",t),{totalDuration:0,lastMigrationDate:null,executedMigrations:[]}}}const hs=Object.freeze(Object.defineProperty({__proto__:null,canStartUpdate:fr,detectStuckMigrations:ut,endMigrationTimer:pr,getAllDbStates:Rt,getDbState:F,getMigrationStats:Sr,getPreviousDbVersion:mr,resetStuckMigration:vt,setUpdateStatus:St,startMigrationTimer:hr,updateDbState:yt},Symbol.toStringTag,{value:"Module"}));class ps{static async addVersionToAllRecords(t,e,r){return new Promise((o,n)=>{try{v(`üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ ${r} –∫–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º –≤ ${e}...`);const a=t.transaction([e],"readwrite"),c=a.objectStore(e);let m=0,h=0;const _=c.getAll();_.onsuccess=()=>{const S=_.result;if(m=S.length,S.length===0){v(`‚úÖ Store ${e} –ø—É—Å—Ç, –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è`),o();return}let w=0;S.forEach($=>{if(!$.hasOwnProperty("version")){$.version=r,w++;const I=c.put($);I.onsuccess=()=>{h++,w--,w===0&&(v(`‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ${e} –∑–∞–≤–µ—Ä—à–µ–Ω–æ:`,{processed:m,updated:h,version:r}),o())},I.onerror=()=>{y(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ ${e}:`,I.error),n(I.error)}}}),w===0&&(v(`‚úÖ –í—Å–µ –∑–∞–ø–∏—Å–∏ –≤ ${e} —É–∂–µ –∏–º–µ—é—Ç –≤–µ—Ä—Å–∏—é`),o())},_.onerror=()=>{y(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –∏–∑ ${e}:`,_.error),n(_.error)},a.onerror=()=>{y(`‚ùå –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ${e}:`,a.error),n(a.error)}}catch(a){y(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ${e}:`,a),n(a)}})}static async validateRecordVersions(t,e){try{v(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –∑–∞–ø–∏—Å–µ–π, –æ–∂–∏–¥–∞–µ–º–∞—è –≤–µ—Ä—Å–∏—è: ${e}`);const r=Array.from(t.objectStoreNames);let o=!0;const n=[];for(const a of r){const c=await this.validateStoreVersions(t,a,e);n.push(c),c.isValid||(o=!1)}return o?v("‚úÖ –í—Å–µ –∑–∞–ø–∏—Å–∏ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≤–µ—Ä—Å–∏–∏"):v("‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–∞–ø–∏—Å–∏ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏:",n),o}catch(r){return y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä—Å–∏–π –∑–∞–ø–∏—Å–µ–π:",r),!1}}static async validateStoreVersions(t,e,r){return new Promise((o,n)=>{try{const m=t.transaction([e],"readonly").objectStore(e).getAll();m.onsuccess=()=>{const h=m.result;let _=0,S=0;h.forEach($=>{$.hasOwnProperty("version")?$.version<r&&S++:_++});const w=_===0&&S===0;o({storeName:e,totalRecords:h.length,recordsWithoutVersion:_,recordsWithOldVersion:S,isValid:w})},m.onerror=()=>{n(m.error)}}catch(a){n(a)}})}static async updateAllStoresVersions(t,e,r){try{const o=r||Array.from(t.objectStoreNames);v(`üîÑ –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –¥–æ ${e} –≤ stores:`,o);for(const n of o)await this.addVersionToAllRecords(t,n,e);v(`‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ –¥–ª—è ${o.length} stores`)}catch(o){throw y("‚ùå –û—à–∏–±–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π:",o),o}}static async getVersionStats(t){try{const e=Array.from(t.objectStoreNames),r=[];let o=0,n=0;for(const a of e){const c=await this.getStoreVersionStats(t,a);r.push(c),o+=c.totalRecords,n+=c.recordsWithoutVersion}return{stores:r,summary:{totalStores:e.length,totalRecords:o,totalWithoutVersion:n}}}catch(e){return y("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–µ—Ä—Å–∏–π:",e),{stores:[],summary:{totalStores:0,totalRecords:0,totalWithoutVersion:0}}}}static async getStoreVersionStats(t,e){return new Promise((r,o)=>{try{const c=t.transaction([e],"readonly").objectStore(e).getAll();c.onsuccess=()=>{const m=c.result,h={};let _=0;m.forEach(S=>{if(!S.hasOwnProperty("version"))_++;else{const w=String(S.version);h[w]=(h[w]||0)+1}}),r({name:e,totalRecords:m.length,versionsDistribution:h,recordsWithoutVersion:_})},c.onerror=()=>{o(c.error)}}catch(n){o(n)}})}static async removeVersionFromAllRecords(t,e){return new Promise((r,o)=>{try{v(`üîÑ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—è version –∏–∑ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –≤ ${e}...`);const a=t.transaction([e],"readwrite").objectStore(e),c=a.getAll();c.onsuccess=()=>{const m=c.result;let h=0,_=0;if(m.length===0){v(`‚úÖ Store ${e} –ø—É—Å—Ç`),r();return}m.forEach(S=>{if(S.hasOwnProperty("version")){delete S.version;const w=a.put(S);w.onsuccess=()=>{_++,h++,h===m.length&&(v(`‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –∏–∑ ${e} –∑–∞–≤–µ—Ä—à–µ–Ω–æ:`,{updated:_}),r())},w.onerror=()=>{o(w.error)}}else h++,h===m.length&&r()})},c.onerror=()=>{o(c.error)}}catch(n){o(n)}})}}const yr=Object.freeze(["accounts","friends","rooms"]),Ss=Object.freeze(Object.defineProperty({__proto__:null,REQUIRED_STORES:yr},Symbol.toStringTag,{value:"Module"}));async function ys(){try{cr("üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º legacy —Ä–µ–µ—Å—Ç—Ä –º–∏–≥—Ä–∞—Ü–∏–π...");const s=await P(()=>import("./LEGASY_MIGRATIONS_REGISTRY-D-EDVjfO.js"),[]);if(!s.LEGACY_MIGRATIONS_REGISTRY)throw new Error("Legacy —Ä–µ–µ—Å—Ç—Ä –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç LEGACY_MIGRATIONS_REGISTRY");return v("‚úÖ Legacy —Ä–µ–µ—Å—Ç—Ä –º–∏–≥—Ä–∞—Ü–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ"),s.LEGACY_MIGRATIONS_REGISTRY}catch(s){throw y("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ legacy —Ä–µ–µ—Å—Ç—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–π:",s),s}}async function ws(s,t){if(!(s<ar))return v("üöÄ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–µ—Å—Ç—Ä –º–∏–≥—Ä–∞—Ü–∏–π (legacy –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)"),{..._t};v("üì¶ –¢—Ä–µ–±—É—é—Ç—Å—è legacy –º–∏–≥—Ä–∞—Ü–∏–∏, –∑–∞–≥—Ä—É–∂–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä:",{oldVersion:s,newVersion:t,minCurrentVersion:ar});const r=await ys(),o={...r,..._t};return v("‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä —Å–æ–∑–¥–∞–Ω:",{legacyCount:Object.keys(r).length,currentCount:Object.keys(_t).length,totalCount:Object.keys(o).length}),o}async function Mt(s){return new Promise((t,e)=>{try{const r=indexedDB.open(s);r.onsuccess=()=>{const o=r.result.version;r.result.close(),t(o)},r.onerror=()=>{e(r.error)},r.onupgradeneeded=()=>{r.result.close(),t(0)}}catch(r){e(r)}})}async function Ds(s,t){const e=t[s];if(!e)throw new Error(`–ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –≤–µ—Ä—Å–∏–∏ ${s} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ`);try{cr(`üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏: ${e}`);const r=await _r(Object.assign({"./combined/-1_tmp_test.ts":()=>P(()=>import("./-1_tmp_test-BlnaWVRx.js"),__vite__mapDeps([0,1,2])),"./combined/0_initialization.ts":()=>P(()=>import("./0_initialization-CS_rwdlJ.js"),__vite__mapDeps([3,1,2])),"./combined/1_accounts_friends.ts":()=>P(()=>import("./1_accounts_friends-BsEYL5H7.js"),__vite__mapDeps([4,1,2,5])),"./combined/2_accounts_versioning.ts":()=>P(()=>import("./2_accounts_versioning-DH1u-_Hl.js"),__vite__mapDeps([6,1,2,5])),"./combined/3_rooms_versioning.ts":()=>P(()=>import("./3_rooms_versioning-mEFb9adH.js"),__vite__mapDeps([7,1,2,5])),"./combined/4_accounts_room_ids.ts":()=>P(()=>import("./4_accounts_room_ids-B6I0sC9g.js"),__vite__mapDeps([8,1,2,5]))}),`./combined/${e}.ts`,3);if(!r.migrationInfo||!r.migrationScheme||!r.migrationData)throw new Error(`–ú–æ–¥—É–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏ ${e} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã (migrationInfo, migrationScheme, migrationData)`);return v(`‚úÖ –ú–æ–¥—É–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏ ${e} –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ`),r}catch(r){throw y(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ ${e}:`,r),r}}async function $s(s,t){const e=new Map;v("üîÑ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –º–∏–≥—Ä–∞—Ü–∏–π:",{oldVersion:s,newVersion:t});try{const r=await ws(s,t);for(let o=s;o<t;o++){const n=await Ds(o,r);e.set(o,n)}return v(`‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${e.size} –º–æ–¥—É–ª–µ–π –º–∏–≥—Ä–∞—Ü–∏–π`),e}catch(r){throw y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π:",r),r}}function xt(){const s=Object.keys(_t).map(Number);return s.length>0?Math.max(...s)+1:1}function bs({db:s,realOldVersion:t,newVersion:e}){v("üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π —Å—Ö–µ–º—ã");for(let r=0;r<e;r++)r===0&&t<=0&&(v("üì¶ –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã 0: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â"),s.objectStoreNames.contains("accounts")||(s.createObjectStore("accounts",{keyPath:"id"}),v("‚úÖ –•—Ä–∞–Ω–∏–ª–∏—â–µ accounts —Å–æ–∑–¥–∞–Ω–æ")),s.objectStoreNames.contains("friends")||(s.createObjectStore("friends",{keyPath:"id"}),v("‚úÖ –•—Ä–∞–Ω–∏–ª–∏—â–µ friends —Å–æ–∑–¥–∞–Ω–æ")),s.objectStoreNames.contains("rooms")||(s.createObjectStore("rooms",{keyPath:"id"}),v("‚úÖ –•—Ä–∞–Ω–∏–ª–∏—â–µ rooms —Å–æ–∑–¥–∞–Ω–æ")),v("‚úÖ –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã 0 –∑–∞–≤–µ—Ä—à–µ–Ω–∞")),r===1&&t<=1&&(v("üì¶ –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤"),v("‚úÖ –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞"));v("üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â..."),s.objectStoreNames.contains("accounts")||(s.createObjectStore("accounts",{keyPath:"id"}),v("‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ accounts")),s.objectStoreNames.contains("friends")||(s.createObjectStore("friends",{keyPath:"id"}),v("‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ friends")),s.objectStoreNames.contains("rooms")||(s.createObjectStore("rooms",{keyPath:"id"}),v("‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ rooms"))}class Is{static async checkOnAppStart(){try{v("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ...");const t=await Rt();for(const e of t)await ut(e.dbName)?(v("‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∑–∞–≤–∏—Å—à–∞—è –º–∏–≥—Ä–∞—Ü–∏—è, –ø–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:",e.dbName),await this.recoverFromIncompleteUpdate(e.dbName)):await this.validateVersionConsistency(e.dbName);v("‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞")}catch(t){y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:",t)}}static async recoverFromIncompleteUpdate(t){try{v("üîÑ –ù–∞—á–∞–ª–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:",t);const e=await F(t);if(!e){v("‚ÑπÔ∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:",t);return}if(!await ut(t)){v("‚ÑπÔ∏è –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≤–∏—Å–ª–∞, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:",t);return}const o=await Mt(t);if(v("üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:",{dbName:t,stateVersion:e.version,realDbVersion:o,targetVersion:e.targetVersion}),e.targetVersion&&o>=e.targetVersion){v("‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ, –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å:",t),await vt(t);return}await vt(t),v("üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –º–∏–≥—Ä–∞—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞:",t)}catch(e){y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ—Å–ª–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:",e);try{await vt(t),v("üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω:",t)}catch(r){y("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º —Å–±—Ä–æ—Å–µ:",r)}}}static async validateVersionConsistency(t){try{const e=await F(t);if(!e)return!0;const r=await Mt(t);return e.version!==r?(v("‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ä–∞—Å—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π:",{dbName:t,stateVersion:e.version,realDbVersion:r}),r>e.version&&(e.version=r,await P(async()=>{const{updateDbState:o}=await Promise.resolve().then(()=>hs);return{updateDbState:o}},void 0).then(({updateDbState:o})=>o(e)),v("‚úÖ –í–µ—Ä—Å–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ —Ä–µ–∞–ª—å–Ω–æ–π:",r)),!1):!0}catch(e){return y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π:",e),!1}}static async validateDataIntegrity(t){try{v("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ë–î:",t.name);const{REQUIRED_STORES:e}=await P(async()=>{const{REQUIRED_STORES:n}=await Promise.resolve().then(()=>Ss);return{REQUIRED_STORES:n}},void 0),r=e.filter(n=>!t.objectStoreNames.contains(n));if(r.length>0)return y("‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ object stores:",r),!1;let o=!0;for(const n of e)try{const m=t.transaction([n],"readonly").objectStore(n).count();await new Promise((h,_)=>{m.onsuccess=()=>h(m.result),m.onerror=()=>_(m.error)})}catch(a){y(`‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ store ${n}:`,a),o=!1}return o?v("‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–π–¥–µ–Ω–∞:",t.name):y("‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö:",t.name),o}catch(e){return y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö:",e),!1}}static async forceResetAllStuckMigrations(){try{v("üö® –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –≤—Å–µ—Ö –∑–∞–≤–∏—Å—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π...");const t=await Rt();let e=0;for(const r of t)await ut(r.dbName)&&(await vt(r.dbName),e++);v(`‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–æ—à–µ–Ω–æ –º–∏–≥—Ä–∞—Ü–∏–π: ${e}`)}catch(t){y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º —Å–±—Ä–æ—Å–µ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π:",t)}}static async getDiagnosticInfo(){try{const t=await Rt(),e=[];let r=0,o=0;for(const n of t){const a=await ut(n.dbName),c=await Mt(n.dbName),m=n.version===c;a&&r++,m||o++,e.push({name:n.dbName,stateVersion:n.version,realVersion:c,isStuck:a,versionConsistent:m})}return{databases:e,summary:{total:e.length,stuck:r,inconsistent:o}}}catch(t){return y("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:",t),{databases:[],summary:{total:0,stuck:0,inconsistent:0}}}}}const G={DB_NAME:"DB_STATE_MANAGER_V2",STORE_NAME:"user_migration_states",VERSION:1};class k{static async getDatabase(){return this.dbPromise||(this.dbPromise=new Promise((t,e)=>{const r=indexedDB.open(G.DB_NAME,G.VERSION);r.onupgradeneeded=o=>{const n=o.target.result;if(!n.objectStoreNames.contains(G.STORE_NAME)){const a=n.createObjectStore(G.STORE_NAME,{keyPath:"userId"});a.createIndex("userId","userId",{unique:!0}),a.createIndex("currentVersion","currentVersion",{unique:!1})}},r.onsuccess=()=>t(r.result),r.onerror=()=>e(r.error)})),this.dbPromise}static async getUserState(t){const e=await this.getDatabase();return new Promise((r,o)=>{const c=e.transaction([G.STORE_NAME],"readonly").objectStore(G.STORE_NAME).get(t);c.onsuccess=()=>r(c.result||null),c.onerror=()=>o(c.error)})}static async updateUserState(t,e){const r=await this.getDatabase(),n={...await this.getUserState(t)||{userId:t,currentVersion:0,completedMigrations:[],migrationHistory:[]},...e};return new Promise((a,c)=>{const _=r.transaction([G.STORE_NAME],"readwrite").objectStore(G.STORE_NAME).put(n);_.onsuccess=()=>a(),_.onerror=()=>c(_.error)})}static async getUsersCompletedVersion(t){const e=await this.getDatabase();return new Promise((r,o)=>{const c=e.transaction([G.STORE_NAME],"readonly").objectStore(G.STORE_NAME).getAll();c.onsuccess=()=>{const h=c.result.filter(_=>_.completedMigrations.includes(t)).map(_=>_.userId);r(h)},c.onerror=()=>o(c.error)})}static async getAllSystemUserIds(){const t=await this.getDatabase();return new Promise((e,r)=>{const a=t.transaction([G.STORE_NAME],"readonly").objectStore(G.STORE_NAME).getAllKeys();a.onsuccess=()=>e(a.result),a.onerror=()=>r(a.error)})}}er(k,"dbPromise",null);class Es{static async loadMigrationModule(t){const e=_t[t];if(!e)throw new Error(`–ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –≤–µ—Ä—Å–∏–∏ ${t} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ä–µ–µ—Å—Ç—Ä–µ`);try{console.log(`üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏: ${e}`);const r=await _r(Object.assign({"./migrations/combined/-1_tmp_test.ts":()=>P(()=>import("./-1_tmp_test-BlnaWVRx.js"),__vite__mapDeps([0,1,2])),"./migrations/combined/0_initialization.ts":()=>P(()=>import("./0_initialization-CS_rwdlJ.js"),__vite__mapDeps([3,1,2])),"./migrations/combined/1_accounts_friends.ts":()=>P(()=>import("./1_accounts_friends-BsEYL5H7.js"),__vite__mapDeps([4,1,2,5])),"./migrations/combined/2_accounts_versioning.ts":()=>P(()=>import("./2_accounts_versioning-DH1u-_Hl.js"),__vite__mapDeps([6,1,2,5])),"./migrations/combined/3_rooms_versioning.ts":()=>P(()=>import("./3_rooms_versioning-mEFb9adH.js"),__vite__mapDeps([7,1,2,5])),"./migrations/combined/4_accounts_room_ids.ts":()=>P(()=>import("./4_accounts_room_ids-B6I0sC9g.js"),__vite__mapDeps([8,1,2,5]))}),`./migrations/combined/${e}.ts`,4);if(!r.migrationInfo)throw new Error(`–ú–æ–¥—É–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏ ${e} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç migrationInfo`);return console.log(`‚úÖ –ú–æ–¥—É–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏ ${e} –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ`),r}catch(r){throw console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ ${e}:`,r),r}}static async getAllMigrations(){const t=[];for(const e of Object.keys(_t).map(Number))try{const r=await this.loadMigrationModule(e);t.push({...r,version:e+1})}catch(r){console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤–µ—Ä—Å–∏–∏ ${e}:`,r)}return t.sort((e,r)=>e.version-r.version)}static async checkUserMigrations(t){var a;const e=await k.getUserState(t),r=(e==null?void 0:e.currentVersion)||0,o=xt(),n=[];for(let c=r+1;c<=o;c++)(a=e==null?void 0:e.completedMigrations)!=null&&a.includes(c)||n.push(c);return n}static async migrateUser(t){const{currentUser:e,db:r,oldVersion:o,newVersion:n}=t,a=e.id;console.log(`üîÑ –ù–∞—á–∏–Ω–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${a} —Å –≤–µ—Ä—Å–∏–∏ ${o} –¥–æ ${n}`),await k.updateUserState(a,{migrationStartTime:Date.now(),currentVersion:o});try{const c=await this.checkUserMigrations(a);for(const m of c){if(m>n)break;await this.executeUserMigration(t,m);const h=await k.getUserState(a)||{userId:a,currentVersion:o,completedMigrations:[],migrationHistory:[]};await k.updateUserState(a,{currentVersion:m,completedMigrations:[...h.completedMigrations,m]})}await k.updateUserState(a,{migrationEndTime:Date.now(),currentVersion:n}),console.log(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${a} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ`)}catch(c){throw console.error(`‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${a}:`,c),await k.updateUserState(a,{migrationEndTime:Date.now(),errorMessage:c instanceof Error?c.message:"Unknown error"}),c}}static async executeUserMigration(t,e){var _;const{currentUser:r}=t;console.log(`üì¶ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –≤–µ—Ä—Å–∏–∏ ${e} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${r.id}`);const o=Date.now(),n=e-1,a=await this.loadMigrationModule(n);if(!a)throw new Error(`–ú–∏–≥—Ä–∞—Ü–∏—è –≤–µ—Ä—Å–∏–∏ ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);a.migrationData&&await a.migrationData(t);const c=Date.now(),m=c-o;console.log(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –≤–µ—Ä—Å–∏–∏ ${e} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${r.id} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${m}–º—Å`);const h=await k.getUserState(r.id);if(h){const S={version:e,fileName:((_=a.migrationInfo)==null?void 0:_.fileName)||`migration_${e}`,schemaDuration:0,dataDuration:m,startTime:o,endTime:c};await k.updateUserState(r.id,{migrationHistory:[...h.migrationHistory,S]})}}static async allUsersCompletedVersion(t,e){const r=await this.scanAllUserIds(t),o=new Set(await k.getUsersCompletedVersion(e));return r.size===o.size&&[...r].every(n=>o.has(n))}static async scanAllUserIds(t){return new Promise((e,r)=>{const a=t.transaction(["accounts"],"readonly").objectStore("accounts").getAll();a.onsuccess=()=>{const c=a.result,m=new Set(c.map(h=>h.id));console.log(`üìä –ù–∞–π–¥–µ–Ω–æ ${m.size} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ:`,[...m]),e(m)},a.onerror=()=>{console.error("‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è accounts –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è userIds:",a.error),r(a.error)}})}static async getUserMigrationStats(t){return await k.getUserState(t)}}class gt{static async scanAllUserIds(t){return new Promise((e,r)=>{const a=t.transaction(["accounts"],"readonly").objectStore("accounts").getAll();a.onsuccess=()=>{const c=a.result,m=new Set(c.map(h=>h.id));e(m)},a.onerror=()=>r(a.error)})}static async allUsersReady(t,e){try{const r=await this.scanAllUserIds(t),o=new Set(await k.getUsersCompletedVersion(e)),n=r.size===o.size&&[...r].every(a=>o.has(a));return console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –≤–µ—Ä—Å–∏–∏ ${e}:`),console.log(`   - –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: ${r.size}`),console.log(`   - –ó–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏—é: ${o.size}`),console.log(`   - –†–µ–∑—É–ª—å—Ç–∞—Ç: ${n?"‚úÖ –í—Å–µ –≥–æ—Ç–æ–≤—ã":"‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ"}`),n}catch(r){return console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:",r),!1}}static async getPendingUsers(t,e){const r=await this.scanAllUserIds(t),o=new Set(await k.getUsersCompletedVersion(e));return[...r].filter(n=>!o.has(n))}static async getUserReadinessStats(t,e){try{const r=await this.scanAllUserIds(t),o=new Set(await k.getUsersCompletedVersion(e)),n=[...r].filter(_=>!o.has(_)),a=r.size,c=o.size,m=a>0?Math.round(c/a*100):100,h=a===c&&a>0;return{totalUsers:a,completedUsers:c,pendingUsers:n,completionPercentage:m,isReady:h}}catch(r){return console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:",r),{totalUsers:0,completedUsers:0,pendingUsers:[],completionPercentage:0,isReady:!1}}}}let V=null,W=null,R=null,J=!1,X=0;const As=5*60*1e3;class et{static async getConnection(){if(await et.checkAndRecoverFromFailures(),V&&!J)return V;if(W)return W;W=et.createNewConnection();try{const t=await W;return V=t,et.setupConnectionHandlers(t),t}catch(t){throw W=null,t}}static async checkAndRecoverFromFailures(){try{const t=Ut.MAIN_LES_STORE_V1;await ut(t)&&(v("üîß –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∑–∞–≤–∏—Å—à–∞—è –º–∏–≥—Ä–∞—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ..."),await et.resetStuckMigration(t)),await Is.checkOnAppStart()}catch(t){y("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î:",t)}}static async resetStuckMigration(t){try{await vt(t),V&&(V.close(),V=null),W=null,v("‚úÖ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞")}catch(e){throw y("‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:",e),e}}static async createNewConnection(){return new Promise(async(t,e)=>{try{const r=Ut.MAIN_LES_STORE_V1;if(!await fr(r))throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.");const n=await Mt(r),a=await mr(r),c=xt();v("üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏—è—Ö –ë–î:",{currentVersion:n,previousStateVersion:a,targetVersion:c,needsMigration:n<c});const m=Math.max(n,a);m<c&&(await St(r,ot.UPDATE_STARTED,m,c),await hr(r,m,c));let h=new Map;if(m<c){const w=Date.now();v("üîÑ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –º–∏–≥—Ä–∞—Ü–∏–π c –≤–µ—Ä—Å–∏–∏:",m),h=await $s(m,c);const $=Date.now()-w;v(`‚úÖ –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${$}–º—Å`)}let _=indexedDB.open(r,c),S=n;_.onupgradeneeded=function(w){const $=_.result,I=w.oldVersion??0,H=w.newVersion??c;if(S=I,v("üîÑ IndexDB onupgradeneeded:",{oldVersion:I,newVersion:H,existingStores:Array.from($.objectStoreNames),detectedCurrentVersion:n,usingRealOldVersion:I}),I!==n&&(v("‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:",{detectedVersion:n,realVersion:I}),h=new Map),I<H)try{h.size===0?bs({db:$,realOldVersion:I,newVersion:H}):et.runSchemaMigrationsWithTiming($,I,H,h,r)}catch(C){throw y("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã IndexedDB:",C),C}},_.onerror=async function(){var w;y("IndexDB openRequest error:",_.error),await St(r,ot.UPDATE_FAILED,void 0,void 0,(w=_.error)==null?void 0:w.message),e(_.error)},_.onsuccess=async function(){let w=_.result;v("‚úÖ IndexDB —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –≤–µ—Ä—Å–∏—è –ë–î:",w.version);try{const $=yr.filter(I=>!w.objectStoreNames.contains(I));if($.length>0){y("üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ object stores:",$),v("üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."),w.close();const I=indexedDB.deleteDatabase(r);I.onsuccess=()=>{v("‚úÖ –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–∞—è –±–∞–∑–∞ —É–¥–∞–ª–µ–Ω–∞"),setTimeout(()=>{v("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã..."),et.createNewConnection().then(t).catch(e)},100)},I.onerror=()=>{y("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–π –±–∞–∑—ã:",I.error),e(I.error)};return}v("‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –ë–î –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é"),v("‚ÑπÔ∏è –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),await St(r,ot.UPDATE_SUCCESS,w.version),await pr(r),t(w)}catch($){y("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö:",$);const I=$ instanceof Error?$.message:String($);await St(r,ot.UPDATE_FAILED,void 0,void 0,I),w.close(),e($)}},_.onblocked=function(){cs("Database connection blocked"),e(new Error("Database connection blocked"))}}catch(r){y("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ IndexDB:",r),e(r)}})}static runSchemaMigrationsWithTiming(t,e,r,o,n){var a,c;v("üöÄ –ù–∞—á–∏–Ω–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π —Å—Ö–µ–º—ã IndexedDB:",{oldVersion:e,newVersion:r,existingStores:Array.from(t.objectStoreNames)});try{for(let m=e;m<r;m++){const h=m+1;v(`üìã –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é —Å—Ö–µ–º—ã —Å –≤–µ—Ä—Å–∏–∏ ${m} –¥–æ ${h}`);const _=o.get(m);if(!_)throw new Error(`–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –≤–µ—Ä—Å–∏–∏ ${m} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);const S=Date.now();_.migrationScheme(t);const w=Date.now()-S;v(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã ${_.migrationInfo.fileName} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${w}–º—Å`);try{_&&typeof _=="object"&&Object.defineProperty(_,"_schemaDuration",{value:w,writable:!0,configurable:!0})}catch($){const I=$ instanceof Error?$.message:String($);console.warn(`Cannot set _schemaDuration on migration module ${(a=_.migrationInfo)==null?void 0:a.fileName}:`,I),v(`‚ö†Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã ${(c=_.migrationInfo)==null?void 0:c.fileName}: ${w}–º—Å (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∞—Ö)`)}}v("üèÅ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã IndexedDB –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ. –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:",Array.from(t.objectStoreNames))}catch(m){throw y("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —Å—Ö–µ–º—ã IndexedDB:",m),m}}static setupConnectionHandlers(t){t.onversionchange=function(){v("üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è IndexDB (version change)"),R&&(clearTimeout(R),R=null),J=!0,X=0,t.close(),V=null,W=null,J=!1},t.onclose=function(){v("üîí –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ IndexDB –∑–∞–∫—Ä—ã—Ç–æ"),R&&(clearTimeout(R),R=null),X=0,V=null,W=null,J=!1}}static incrementActiveRequests(){X++,R&&(clearTimeout(R),R=null)}static decrementActiveRequests(){X=Math.max(0,X-1),X===0&&et.startCloseTimer()}static startCloseTimer(){R&&clearTimeout(R),R=setTimeout(()=>{V&&!J&&X===0&&(v(`üîí –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è IndexDB –ø–æ —Ç–∞–π–º–∞—É—Ç—É (5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤). –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: ${X}`),J=!0,V.close(),V=null,W=null,R=null,J=!1)},As)}static forceCloseConnection(){V&&(v("üîí –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è IndexDB"),R&&(clearTimeout(R),R=null),J=!0,X=0,V.close(),V=null,W=null,J=!1)}static getConnectionInfo(){return{hasConnection:!!V,isClosing:J,activeRequestsCount:X,hasCloseTimer:!!R,connectionPromiseActive:!!W}}static async checkMigrationReadiness(){try{const t=await this.getConnection(),e=xt(),r=await gt.allUsersReady(t,e),o=await gt.getPendingUsers(t,e);return{isReady:r,pendingUsers:o,systemStatus:r?"ready":o.length>0?"partial":"blocked"}}catch(t){return console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–π:",t),{isReady:!1,pendingUsers:[],systemStatus:"blocked"}}}static async getUsersMigrationSummary(){try{const t=await this.getConnection(),e=xt(),r=await gt.getUserReadinessStats(t,e),o=await gt.scanAllUserIds(t),n=[];for(const a of o){const c=await Es.getUserMigrationStats(a);n.push({userId:a,currentVersion:(c==null?void 0:c.currentVersion)||0,completedMigrations:(c==null?void 0:c.completedMigrations)||[],isReady:(c==null?void 0:c.currentVersion)===e})}return{totalUsers:r.totalUsers,completedUsers:r.completedUsers,pendingUsers:r.pendingUsers,completionPercentage:r.completionPercentage,userDetails:n}}catch(t){return console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:",t),{totalUsers:0,completedUsers:0,pendingUsers:[],completionPercentage:0,userDetails:[]}}}}const ir={accounts_by_id:{},friends_by_id:{},rooms_by_id:{}};var Ts=O('<span class="status-text svelte-4jntj4"> </span>'),Rs=O('<div><span class="status-dot svelte-4jntj4"></span> <!></div>');function Ms(s,t){let e=ye(t,"size",3,"md"),r=ye(t,"animated",3,!0),o=ye(t,"className",3,"");const n=()=>{let h=["status-indicator",`status-${t.status}`,`size-${e()}`];return r()&&h.push("animated"),o()&&h.push(o()),h.join(" ")};var a=Rs(),c=g(l(a),2);{var m=h=>{var _=Ts(),S=l(_);M(()=>b(S,t.text)),A(h,_)};st(c,h=>{t.text&&h(m)})}M(h=>d(a,1,h,"svelte-4jntj4"),[()=>u(n())]),A(s,a)}var xs=O('<div><div class="theme-preview svelte-gyqbuc"><span class="theme-icon svelte-gyqbuc"> </span> <div class="theme-info svelte-gyqbuc"><div class="theme-name svelte-gyqbuc"> </div> <div class="theme-description svelte-gyqbuc"> </div></div></div> <div class="theme-actions svelte-gyqbuc"><!></div></div>'),Us=O('<div class="theme-selector svelte-gyqbuc"><div class="themes-grid svelte-gyqbuc"></div></div>');function Vs(s,t){dr(t,!1);const[e,r]=vr(),o=()=>De(gr,"$theme",e),n={cyberpunk:"üåÜ",watchdogs:"üîç",pixel:"üéÆ",terminal:"üíª",arabic:"üïå"},a={cyberpunk:"–¢–µ–º–Ω–∞—è –∫–∏–±–µ—Ä–ø–∞–Ω–∫ —Ç–µ–º–∞ —Å –Ω–µ–æ–Ω–æ–≤—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏",watchdogs:"–°—Ç–∏–ª—å –≤ –¥—É—Ö–µ —Ö–∞–∫–µ—Ä—Å–∫–∏—Ö —Ñ–∏–ª—å–º–æ–≤",pixel:"–†–µ—Ç—Ä–æ –ø–∏–∫—Å–µ–ª—å–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞",terminal:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å",arabic:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –∞—Ä–∞–±—Å–∫–∏–π —Å—Ç–∏–ª—å"};lr();var c=Us(),m=l(c);we(m,5,()=>ls,$e,(h,_)=>{var S=xs();let w;var $=l(S),I=l($),H=l(I),C=g(I,2),wt=l(C),Vt=l(wt),Pt=g(wt,2),kt=l(Pt),Ot=g($,2),Ct=l(Ot);const Nt=rt(()=>o()===f(_)?"primary":"outline"),Bt=rt(()=>o()===f(_));q(Ct,{get variant(){return f(Nt)},size:"sm",onclick:()=>ds(f(_)),get disabled(){return f(Bt)},children:(mt,Dt)=>{var nt=z();M(()=>b(nt,o()===f(_)?"‚úì –ê–∫—Ç–∏–≤–Ω–∞":"–ü—Ä–∏–º–µ–Ω–∏—Ç—å")),A(mt,nt)},$$slots:{default:!0}}),M((mt,Dt)=>{w=d(S,1,"theme-option svelte-gyqbuc",null,w,mt),b(H,n[f(_)]||"üé®"),b(Vt,Dt),b(kt,a[f(_)])},[()=>({active:o()===f(_)}),()=>f(_).toUpperCase()],rt),A(h,S)}),A(s,c),ur(),r()}async function wr(){try{if("databases"in indexedDB){const s=await indexedDB.databases();console.log(`Found ${s.length} IndexedDB database(s) to delete`);for(const t of s)if(t.name)try{const e=indexedDB.deleteDatabase(t.name);await new Promise((r,o)=>{e.onsuccess=()=>{console.log(`‚úì IndexedDB database deleted: ${t.name}`),r()},e.onerror=n=>{console.error(`Error deleting IndexedDB database: ${t.name}`,n),o(new Error(`Failed to delete database: ${t.name}`))},e.onblocked=()=>{console.warn(`IndexedDB database deletion blocked: ${t.name}`),r()}})}catch(e){console.error(`Error deleting IndexedDB database: ${t.name}`,e)}}else{console.log("Modern databases() API not available, using fallback method");const s=["store_v3","store_v2","store_v1","store"];for(const t of s)try{const e=indexedDB.deleteDatabase(t);await new Promise((r,o)=>{e.onsuccess=()=>{console.log(`‚úì IndexedDB database deleted: ${t}`),r()},e.onerror=()=>{console.log(`IndexedDB database not found or already deleted: ${t}`),r()},e.onblocked=()=>{console.warn(`IndexedDB database deletion blocked: ${t}`),r()}})}catch(e){console.error(`Error deleting IndexedDB database: ${t}`,e)}}console.log("‚úì IndexedDB databases cleared")}catch(s){throw console.error("Error clearing IndexedDB databases:",s),s}}async function Ps(){try{if(localStorage.clear(),console.log("‚úì localStorage cleared"),sessionStorage.clear(),console.log("‚úì sessionStorage cleared"),"serviceWorker"in navigator){const s=await navigator.serviceWorker.getRegistrations();if(s.length>0){console.log(`Found ${s.length} service worker(s) to unregister`);for(const t of s)try{await t.unregister(),console.log("‚úì Service worker unregistered:",t.scope)}catch(e){console.error("Error unregistering service worker:",e)}}else console.log("No service workers found")}else console.log("Service Workers not supported in this browser");if("indexedDB"in window)try{await wr()}catch(s){console.error("Error clearing IndexedDB:",s)}if("caches"in window)try{const s=await caches.keys();if(s.length>0){console.log(`Found ${s.length} cache(s) to delete`);for(const t of s)await caches.delete(t),console.log("‚úì Cache deleted:",t)}else console.log("No caches found")}catch(s){console.error("Error clearing caches:",s)}console.log("üßπ App data clearing completed"),alert("–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—á–∏—â–µ–Ω—ã! –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞."),window.location.reload()}catch(s){console.error("Error during app data clearing:",s),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö: "+(s instanceof Error?s.message:String(s)))}}async function ks(){try{if("serviceWorker"in navigator){const s=await navigator.serviceWorker.getRegistrations();if(s.length>0){console.log(`Found ${s.length} service worker(s) to unregister`);for(const t of s)try{await t.unregister(),console.log("‚úì Service worker unregistered:",t.scope)}catch(e){console.error("Error unregistering service worker:",e)}alert("Service Workers –æ—á–∏—â–µ–Ω—ã! –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞."),window.location.reload()}else alert("Service Workers –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")}else alert("Service Workers –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ")}catch(s){console.error("Error clearing service workers:",s),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ Service Workers: "+(s instanceof Error?s.message:String(s)))}}function Os(){try{localStorage.clear(),sessionStorage.clear(),console.log("‚úì Storage cleared"),alert("–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ—á–∏—â–µ–Ω–æ!")}catch(s){console.error("Error clearing storage:",s),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: "+(s instanceof Error?s.message:String(s)))}}async function Cs(){try{"indexedDB"in window?(await wr(),alert("IndexedDB –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω—ã!")):alert("IndexedDB –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ")}catch(s){console.error("Error clearing IndexedDB:",s),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ IndexedDB: "+(s instanceof Error?s.message:String(s)))}}const Ns="_settingsContainer_1p21f_1",Bs="_settingsGrid_1p21f_10",js="_settingSection_1p21f_16",Ls="_sectionTitle_1p21f_22",qs="_settingItem_1p21f_33",zs="_settingHeader_1p21f_50",Gs="_settingName_1p21f_57",Hs="_settingIcon_1p21f_66",Ws="_settingDescription_1p21f_70",Fs="_settingActions_1p21f_77",Ys="_statusIndicator_1p21f_99",Qs="_statusActive_1p21f_110",Ks="_themeSelector_1p21f_122",Js="_clearOptions_1p21f_126",Xs="_versionResults_1p21f_180",Zs="_userList_1p21f_187",to="_userItem_1p21f_193",eo="_statsGrid_1p21f_199",ro="_errorMessage_1p21f_206",so="_authRequired_1p21f_214",oo="_authMessage_1p21f_222",no="_authDescription_1p21f_228",ao="_authActions_1p21f_233",io="_emptyMessage_1p21f_238",co="_migrationList_1p21f_245",lo="_migrationItem_1p21f_254",uo="_migrationHeader_1p21f_267",vo="_migrationDetails_1p21f_274",i={settingsContainer:Ns,settingsGrid:Bs,settingSection:js,sectionTitle:Ls,settingItem:qs,settingHeader:zs,settingName:Gs,settingIcon:Hs,settingDescription:Ws,settingActions:Fs,statusIndicator:Ys,statusActive:Qs,themeSelector:Ks,clearOptions:Js,versionResults:Xs,userList:Zs,userItem:to,statsGrid:eo,errorMessage:ro,authRequired:so,authMessage:oo,authDescription:no,authActions:ao,emptyMessage:io,migrationList:co,migrationItem:lo,migrationHeader:uo,migrationDetails:vo};var go=O("<div><!> <!> <!> <!></div>"),_o=O("<div><div><strong> </strong></div> <div><span> </span> <span> </span> <span> </span> <span> </span></div></div>"),mo=O("<h4>üîç –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º</h4> <div></div>",1),fo=O("<div><h4>üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4> <div><div><strong>–û–±—â–µ–µ –≤—Ä–µ–º—è:</strong> </div> <div><strong>–ü–æ—Å–ª–µ–¥–Ω—è—è –º–∏–≥—Ä–∞—Ü–∏—è:</strong> </div> <div><strong>–í—ã–ø–æ–ª–Ω–µ–Ω–æ –º–∏–≥—Ä–∞—Ü–∏–π:</strong> </div></div> <!></div>"),ho=O("<div> </div>"),po=O(`<div><div>üîê –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–µ—Ä—Å–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</div> <div>–î–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–π –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –∏ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è
                            –¥–æ—Å—Ç—É–ø–∞.</div> <div><!></div></div>`),So=O("<div>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞</div>"),yo=O("<div> </div>"),wo=O("<div><h4>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:</h4> <div><!></div> <h4>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</h4> <div><div> </div> <div> </div> <div> </div></div> <h4>üë• –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Friends (–≤ –ø–∞–º—è—Ç–∏):</h4> <div><div> </div> <div> </div> <div> </div> <div> </div></div> <h4>üè† –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Rooms (–≤ –ø–∞–º—è—Ç–∏):</h4> <div><div> </div> <div> </div> <div> </div> <div> </div></div></div>"),Do=O(`<div><div><div><h2>üîß –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2> <div><div><div><span>üé®</span> –¢–µ–º—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div> <!></div> <div>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞
                    –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.</div> <div><!></div></div> <div><div><div><span>‚ö°</span> –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</div> <span> </span></div> <div>–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ. –í—Å–µ –º–æ–¥—É–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç
                    –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</div> <div><!></div></div></div> <div><h2>üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h2> <div><div><div><span>üíΩ</span> –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</div> <span>‚óè –î–û–°–¢–£–ü–ù–û</span></div> <div>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏,
                    –∫—ç—à –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.</div> <div><!></div> <!></div></div> <div><h2>üóÇÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏</h2> <div><div><div><span>üìä</span> –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫</div> <span> </span></div> <div>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤
                    —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ SharedWorker. –°—á–µ—Ç—á–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                    –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏/–∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–æ–∫.</div></div> <div><div><div><span>üö™</span> –ó–∞–∫—Ä—ã—Ç–∏–µ –≤–∫–ª–∞–¥–æ–∫</div> <span>‚óè –î–û–°–¢–£–ü–ù–û</span></div> <div>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –≤–∫–ª–∞–¥–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ broadcast
                    —Å–æ–æ–±—â–µ–Ω–∏—è. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å –≤–∫–ª–∞–¥–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ –≤—Å–µ
                    —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</div> <div><!> <!></div> <div style="margin-top: 8px; font-size: 0.9em; color: var(--color-text-secondary);">‚ö†Ô∏è "–ó–∞–∫—Ä—ã—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏" - –∑–∞–∫—Ä–æ–µ—Ç –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∫—Ä–æ–º–µ
                    —Ç–µ–∫—É—â–µ–π<br/> ‚ö†Ô∏è "–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏" - –∑–∞–∫—Ä–æ–µ—Ç –≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É</div></div></div> <div><h2>‚è±Ô∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π</h2> <div><div><div><span>üìä</span> –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π</div> <span>‚óè –î–û–°–¢–£–ü–ù–û</span></div> <div>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã
                    –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –æ–±—â–µ–µ
                    –≤—Ä–µ–º—è.</div> <div><!></div> <!></div></div> <div><h2>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–µ—Ä—Å–∏–π</h2> <div><div><div><span>üìä</span> –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π —Å—É—â–Ω–æ—Å—Ç–µ–π</div> <span>‚óè –î–û–°–¢–£–ü–ù–û</span></div> <div>–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ –±–∞–∑–µ
                    –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö —Ç–µ–∫—É—â–∏–µ –≤–µ—Ä—Å–∏–∏.</div> <div><!></div> <!> <!> <!></div></div> <div><h2>üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è</h2> <div><div><div><span>üè†</span> –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</div></div> <div>–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</div> <div><!></div></div></div></div></div>`);function $o(s,t){dr(t,!1);const[e,r]=vr(),o=()=>De(vs,"$appAuthStore",e),n=()=>De(gr,"$theme",e);let a="operational",c=K(!1),m=K(0),h=K(!1),_=K(!1),S=K(null),w=K(null),$=K(!1),I=K(!1),H=K(!1),C=K(null);us(()=>ms.tabs.subscribeActiveTabsCount(E=>{x(m,E)}));function wt(){x(c,!f(c))}async function Vt(){confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")&&await Ps()}async function Pt(){confirm("–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ Service Workers?")&&await ks()}function kt(){confirm("–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ?")&&Os()}async function Ot(){confirm("–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ IndexedDB –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?")&&await Cs()}const Ct=()=>{alert("–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö")};function Nt(){confirm("–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è? –¢–µ–∫—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π.")&&or.closeAllOtherTabs()}function Bt(){confirm("–ó–∞–∫—Ä—ã—Ç—å –í–°–ï –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â—É—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –∑–∞–∫—Ä–æ–µ—Ç –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.")&&or.closeAllTabsIncludingCurrent()}async function mt(){x(_,!0),x(w,null),x(S,null),x($,!1);try{const p=o();if(Object.keys(p.byId).length===0){x($,!0),x(h,!0);return}const D=await et.getConnection(),N=await gt.getUserReadinessStats(D,2),B=await ps.getVersionStats(D),Y=await gt.scanAllUserIds(D),T=Object.values(ir.friends_by_id),j=Object.values(ir.rooms_by_id),U={total:T.length,withVersion:T.filter(L=>L.version!==void 0).length,withoutVersion:T.filter(L=>L.version===void 0).length},at={total:j.length,withVersion:j.filter(L=>L.version!==void 0).length,withoutVersion:j.filter(L=>L.version===void 0).length};x(S,{userStats:N,versionStats:B,allUserIds:Array.from(Y),entitiesStats:{friends:U,rooms:at}}),x(h,!0)}catch(p){x(w,p instanceof Error?p.message:String(p))}finally{x(_,!1)}}async function Dt(){x(H,!0);try{const p=await Sr(Ut.MAIN_LES_STORE_V1);x(C,p),x(I,!0)}catch(p){console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π:",p),alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–π")}finally{x(H,!1)}}function nt(p){return p<1e3?`${p}–º—Å`:p<6e4?`${(p/1e3).toFixed(1)}—Å`:`${(p/6e4).toFixed(1)}–º–∏–Ω`}lr();var jt=Do(),Ie=l(jt),Lt=l(Ie),Ee=l(Lt),qt=g(Ee,2),zt=l(qt),Gt=l(zt),Dr=l(Gt),$r=g(Gt,2);const br=rt(()=>n().toUpperCase()),Ir=rt(()=>`${i.statusIndicator} ${i.statusActive}`);Ms($r,{status:"active",get text(){return f(br)},get className(){return f(Ir)}});var Ae=g(zt,2),Te=g(Ae,2),Er=l(Te);Vs(Er,{});var Re=g(qt,2),Ht=l(Re),Wt=l(Ht),Ar=l(Wt),Me=g(Wt,2),Tr=l(Me),xe=g(Ht,2),Ue=g(xe,2),Rr=l(Ue);q(Rr,{variant:"outline",size:"sm",onclick:Ct,children:(p,E)=>{var D=z("üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞");A(p,D)},$$slots:{default:!0}});var Ft=g(Lt,2),Ve=l(Ft),Pe=g(Ve,2),Yt=l(Pe),Qt=l(Yt),Mr=l(Qt),xr=g(Qt,2),ke=g(Yt,2),Kt=g(ke,2),Ur=l(Kt);q(Ur,{variant:"outline",size:"sm",onclick:wt,children:(p,E)=>{var D=z();M(()=>b(D,f(c)?"–°–∫—Ä—ã—Ç—å –æ–ø—Ü–∏–∏":"–ü–æ–∫–∞–∑–∞—Ç—å –æ–ø—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏")),A(p,D)},$$slots:{default:!0}});var Vr=g(Kt,2);{var Pr=p=>{var E=go(),D=l(E);q(D,{variant:"danger",size:"sm",onclick:Vt,children:(T,j)=>{var U=z("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ");A(T,U)},$$slots:{default:!0}});var N=g(D,2);q(N,{variant:"outline",size:"sm",onclick:Pt,children:(T,j)=>{var U=z("üîß –û—á–∏—Å—Ç–∏—Ç—å Service Workers");A(T,U)},$$slots:{default:!0}});var B=g(N,2);q(B,{variant:"outline",size:"sm",onclick:kt,children:(T,j)=>{var U=z("üíæ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ");A(T,U)},$$slots:{default:!0}});var Y=g(B,2);q(Y,{variant:"outline",size:"sm",onclick:Ot,children:(T,j)=>{var U=z("üóÑÔ∏è –û—á–∏—Å—Ç–∏—Ç—å IndexedDB");A(T,U)},$$slots:{default:!0}}),M(()=>d(E,1,u(i.clearOptions))),A(p,E)};st(Vr,p=>{f(c)&&p(Pr)})}var Jt=g(Ft,2),Oe=l(Jt),Xt=g(Oe,2),Zt=l(Xt),te=l(Zt),kr=l(te),Ce=g(te,2),Or=l(Ce),Cr=g(Zt,2),Ne=g(Xt,2),ee=l(Ne),re=l(ee),Nr=l(re),Br=g(re,2),Be=g(ee,2),se=g(Be,2),je=l(se);q(je,{variant:"outline",size:"sm",onclick:Nt,children:(p,E)=>{var D=z("üóÇÔ∏è –ó–∞–∫—Ä—ã—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏");A(p,D)},$$slots:{default:!0}});var jr=g(je,2);q(jr,{variant:"danger",size:"sm",onclick:Bt,children:(p,E)=>{var D=z("‚ùå –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏");A(p,D)},$$slots:{default:!0}});var Lr=g(se,2),oe=g(Jt,2),Le=l(oe),qe=g(Le,2),ne=l(qe),ae=l(ne),qr=l(ae),zr=g(ae,2),ze=g(ne,2),ie=g(ze,2),Gr=l(ie);q(Gr,{variant:"outline",size:"sm",onclick:Dt,get disabled(){return f(H)},children:(p,E)=>{var D=z();M(()=>b(D,f(H)?"üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...":"üìà –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É")),A(p,D)},$$slots:{default:!0}});var Hr=g(ie,2);{var Wr=p=>{var E=fo(),D=g(l(E),2),N=l(D),B=g(l(N)),Y=g(N,2),T=g(l(Y)),j=g(Y,2),U=g(l(j)),at=g(D,2);{var L=it=>{var ct=mo(),dt=g(nr(ct),2);we(dt,5,()=>f(C).executedMigrations,$e,($t,Z)=>{var lt=_o(),ft=l(lt),bt=l(ft),ge=l(bt),It=g(ft,2),Et=l(It),At=l(Et),ht=g(Et,2),_e=l(ht),pt=g(ht,2),me=l(pt),Tt=g(pt,2),fe=l(Tt);M((he,pe,Q,tt)=>{d(lt,1,u(i.migrationItem)),d(ft,1,u(i.migrationHeader)),b(ge,`v${f(Z).version??""} - ${f(Z).fileName??""}`),d(It,1,u(i.migrationDetails)),b(At,`–°—Ö–µ–º–∞: ${he??""}`),b(_e,`–î–∞–Ω–Ω—ã–µ: ${pe??""}`),b(me,`–û–±—â–µ–µ: ${Q??""}`),b(fe,`–ó–∞–≤–µ—Ä—à–µ–Ω–∞: ${tt??""}`)},[()=>nt(f(Z).schemaDuration),()=>nt(f(Z).dataDuration),()=>nt(f(Z).schemaDuration+f(Z).dataDuration),()=>new Date(f(Z).endTime).toLocaleTimeString()],rt),A($t,lt)}),M(()=>d(dt,1,u(i.migrationList))),A(it,ct)};st(at,it=>{f(C).executedMigrations.length>0&&it(L)})}M((it,ct)=>{d(E,1,u(i.versionResults)),d(D,1,u(i.statsGrid)),b(B,` ${it??""}`),b(T,` ${ct??""}`),b(U,` ${f(C).executedMigrations.length??""}`)},[()=>nt(f(C).totalDuration),()=>f(C).lastMigrationDate?f(C).lastMigrationDate.toLocaleString():"–ù–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å"],rt),A(p,E)};st(Hr,p=>{f(I)&&f(C)&&p(Wr)})}var ce=g(oe,2),Ge=l(ce),He=g(Ge,2),de=l(He),le=l(de),Fr=l(le),Yr=g(le,2),We=g(de,2),ue=g(We,2),Qr=l(ue);q(Qr,{variant:"outline",size:"sm",onclick:mt,get disabled(){return f(_)},children:(p,E)=>{var D=z();M(()=>b(D,f(_)?"‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...":"üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏–∏")),A(p,D)},$$slots:{default:!0}});var Fe=g(ue,2);{var Kr=p=>{var E=ho(),D=l(E);M(()=>{d(E,1,u(i.errorMessage)),b(D,`‚ùå –û—à–∏–±–∫–∞: ${f(w)??""}`)}),A(p,E)};st(Fe,p=>{f(w)&&p(Kr)})}var Ye=g(Fe,2);{var Jr=p=>{var E=po(),D=l(E),N=g(D,2),B=g(N,2),Y=l(B);rr(Y,{get href(){return sr.AUTH},children:(T,j)=>{q(T,{variant:"primary",size:"sm",children:(U,at)=>{var L=z("–ü–µ—Ä–µ–π—Ç–∏ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");A(U,L)},$$slots:{default:!0}})},$$slots:{default:!0}}),M(()=>{d(E,1,u(i.authRequired)),d(D,1,u(i.authMessage)),d(N,1,u(i.authDescription)),d(B,1,u(i.authActions))}),A(p,E)};st(Ye,p=>{f(h)&&f($)&&p(Jr)})}var Xr=g(Ye,2);{var Zr=p=>{var E=wo(),D=g(l(E),2),N=l(D);{var B=Q=>{var tt=So();M(()=>d(tt,1,u(i.emptyMessage))),A(Q,tt)},Y=Q=>{var tt=gs(),rs=nr(tt);we(rs,1,()=>f(S).allUserIds,$e,(ss,os)=>{var Se=yo(),ns=l(Se);M(()=>{d(Se,1,u(i.userItem)),b(ns,`User ID: ${f(os)??""} | Version: ${f(S).userStats.completedUsers>0?"2":"1"}`)}),A(ss,Se)}),A(Q,tt)};st(N,Q=>{f(S).allUserIds.length===0?Q(B):Q(Y,!1)})}var T=g(D,4),j=l(T),U=l(j),at=g(j,2),L=l(at),it=g(at,2),ct=l(it),dt=g(T,4),$t=l(dt),Z=l($t),lt=g($t,2),ft=l(lt),bt=g(lt,2),ge=l(bt),It=g(bt,2),Et=l(It),At=g(dt,4),ht=l(At),_e=l(ht),pt=g(ht,2),me=l(pt),Tt=g(pt,2),fe=l(Tt),he=g(Tt,2),pe=l(he);M((Q,tt)=>{d(E,1,u(i.versionResults)),d(D,1,u(i.userList)),d(T,1,u(i.statsGrid)),b(U,`–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${f(S).userStats.totalUsers??""}`),b(L,`–ó–∞–≤–µ—Ä—à–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é: ${f(S).userStats.completedUsers??""}`),b(ct,`–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: ${f(S).userStats.completionPercentage??""}%`),d(dt,1,u(i.statsGrid)),b(Z,`–í—Å–µ–≥–æ friends: ${f(S).entitiesStats.friends.total??""}`),b(ft,`–° –≤–µ—Ä—Å–∏–µ–π: ${f(S).entitiesStats.friends.withVersion??""}`),b(ge,`–ë–µ–∑ –≤–µ—Ä—Å–∏–∏: ${f(S).entitiesStats.friends.withoutVersion??""}`),b(Et,`–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: ${Q??""}%`),d(At,1,u(i.statsGrid)),b(_e,`–í—Å–µ–≥–æ rooms: ${f(S).entitiesStats.rooms.total??""}`),b(me,`–° –≤–µ—Ä—Å–∏–µ–π: ${f(S).entitiesStats.rooms.withVersion??""}`),b(fe,`–ë–µ–∑ –≤–µ—Ä—Å–∏–∏: ${f(S).entitiesStats.rooms.withoutVersion??""}`),b(pe,`–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: ${tt??""}%`)},[()=>f(S).entitiesStats.friends.total>0?Math.round(f(S).entitiesStats.friends.withVersion/f(S).entitiesStats.friends.total*100):100,()=>f(S).entitiesStats.rooms.total>0?Math.round(f(S).entitiesStats.rooms.withVersion/f(S).entitiesStats.rooms.total*100):100],rt),A(p,E)};st(Xr,p=>{f(h)&&f(S)&&!f($)&&p(Zr)})}var Qe=g(ce,2),Ke=l(Qe),Je=g(Ke,2),ve=l(Je),Xe=l(ve),ts=l(Xe),Ze=g(ve,2),tr=g(Ze,2),es=l(tr);rr(es,{get href(){return sr.HOME},children:(p,E)=>{q(p,{variant:"outline",size:"sm",children:(D,N)=>{var B=z("–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é");A(D,B)},$$slots:{default:!0}})},$$slots:{default:!0}}),M(p=>{d(jt,1,u(i.settingsContainer)),d(Ie,1,u(i.settingsGrid)),d(Lt,1,u(i.settingSection)),d(Ee,1,u(i.sectionTitle)),d(qt,1,u(i.settingItem)),d(zt,1,u(i.settingHeader)),d(Gt,1,u(i.settingName)),d(Dr,1,u(i.settingIcon)),d(Ae,1,u(i.settingDescription)),d(Te,1,u(i.themeSelector)),d(Re,1,u(i.settingItem)),d(Ht,1,u(i.settingHeader)),d(Wt,1,u(i.settingName)),d(Ar,1,u(i.settingIcon)),d(Me,1,`${i.statusIndicator} ${i.statusActive}`),b(Tr,`‚óè ${p??""}`),d(xe,1,u(i.settingDescription)),d(Ue,1,u(i.settingActions)),d(Ft,1,u(i.settingSection)),d(Ve,1,u(i.sectionTitle)),d(Pe,1,u(i.settingItem)),d(Yt,1,u(i.settingHeader)),d(Qt,1,u(i.settingName)),d(Mr,1,u(i.settingIcon)),d(xr,1,`${i.statusIndicator} ${i.statusActive}`),d(ke,1,u(i.settingDescription)),d(Kt,1,u(i.settingActions)),d(Jt,1,u(i.settingSection)),d(Oe,1,u(i.sectionTitle)),d(Xt,1,u(i.settingItem)),d(Zt,1,u(i.settingHeader)),d(te,1,u(i.settingName)),d(kr,1,u(i.settingIcon)),d(Ce,1,`${i.statusIndicator} ${i.statusActive}`),b(Or,`‚óè ${f(m)??""} –ê–ö–¢–ò–í–ù–´–•`),d(Cr,1,u(i.settingDescription)),d(Ne,1,u(i.settingItem)),d(ee,1,u(i.settingHeader)),d(re,1,u(i.settingName)),d(Nr,1,u(i.settingIcon)),d(Br,1,`${i.statusIndicator} ${i.statusActive}`),d(Be,1,u(i.settingDescription)),d(se,1,u(i.settingActions)),d(Lr,1,u(i.settingDescription)),d(oe,1,u(i.settingSection)),d(Le,1,u(i.sectionTitle)),d(qe,1,u(i.settingItem)),d(ne,1,u(i.settingHeader)),d(ae,1,u(i.settingName)),d(qr,1,u(i.settingIcon)),d(zr,1,`${i.statusIndicator} ${i.statusActive}`),d(ze,1,u(i.settingDescription)),d(ie,1,u(i.settingActions)),d(ce,1,u(i.settingSection)),d(Ge,1,u(i.sectionTitle)),d(He,1,u(i.settingItem)),d(de,1,u(i.settingHeader)),d(le,1,u(i.settingName)),d(Fr,1,u(i.settingIcon)),d(Yr,1,`${i.statusIndicator} ${i.statusActive}`),d(We,1,u(i.settingDescription)),d(ue,1,u(i.settingActions)),d(Qe,1,u(i.settingSection)),d(Ke,1,u(i.sectionTitle)),d(Je,1,u(i.settingItem)),d(ve,1,u(i.settingHeader)),d(Xe,1,u(i.settingName)),d(ts,1,u(i.settingIcon)),d(Ze,1,u(i.settingDescription)),d(tr,1,u(i.settingActions))},[()=>a.toUpperCase()],rt),A(s,jt),ur(),r()}function To(s){_s(s,{title:"–°–ò–°–¢–ï–ú–ê_–ù–ê–°–¢–†–û–ï–ö",subtitle:"–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø_–ò_–£–ü–†–ê–í–õ–ï–ù–ò–ï_–°–ò–°–¢–ï–ú–û–ô",pageName:"SettingsPage",children:(t,e)=>{$o(t,{})},$$slots:{default:!0}})}export{To as default};
