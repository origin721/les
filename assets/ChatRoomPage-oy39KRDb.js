import{v as R,o as A,q as C,p as E,f as d,a as T,L as J,b as v,R as j,e as n,j as x,w as L,c,u as Q,x as K,y as h,h as U,m as V,k as H,l as M,z as Y,A as k,B as G,C as W,D as X,t as Z,E as ee,Q as te,r as re}from"./index-DCzsrXNc.js";import{r as ae}from"./legacy-client-6QFgOQNG.js";import{e as S,m as se}from"./events_store-B-EWoCSc.js";const D=Object.freeze({ping:"ping",server_event_registration:"server_event_registration",send_by_pub_key:"send_by_pub_key"}),oe={ping:"ping"};async function ne(t,r){let a;if(t.path===D.server_event_registration){const e=r,o=JSON.stringify({path:t.path,uuid:R(),created_date:new Date,body:{connection_id:t.body.connection_id,pub_key_ed25519_client:e.pub_key_ed25519_client}});a=await A({receiverPublicKey:e.pub_key_curve25519_server,message:JSON.stringify({payloadSignature:await C({receiverPublicKey:e.pub_key_curve25519_server,senderPrivateKey:e.priv_key_curve25519_client,message:o}),pub_key_curve25519_client:e.pub_key_curve25519_client})})}else if(t.path===D.send_by_pub_key){const e=r,o=JSON.stringify({path:t.path,uuid:R(),created_date:new Date,body:t.body});a=await A({receiverPublicKey:e.pub_key_curve25519_server,message:JSON.stringify({payloadSignature:await C({receiverPublicKey:e.pub_key_curve25519_server,senderPrivateKey:e.priv_key_curve25519_client,message:o}),pub_key_curve25519_client:e.pub_key_curve25519_client})})}else console.error("не существует метода");return fetch("/events",{method:"POST",headers:{"Content-Type":"application/json"},body:a})}function _e(t,r){ne({path:oe.ping,payload:{room_ids:Object.keys(r().rooms)}})}var ie=d("<p>back</p>"),ce=d("<div><p> </p> <p> </p> <hr/></div>"),ve=d('<!> <textarea class="bg-blue-900 text-blue-200"></textarea> <button class="text-teal-500">send message</button> <button>send</button> <div><h1 class="text-2xl text-cyan-400"> </h1> <div></div></div> <div><pre> </pre></div>',1);function le(t,r){E(r,!0);const[a,e]=M(),o=()=>x(S,"$events_store",a),p=()=>x(_,"$messageTextField",a);let _=L("");var l=ve(),y=T(l);J(y,{className:"text-yellow-500",get href(){return j.CHAT_ROOMS},children:(i,P)=>{var f=ie();v(i,f)},$$slots:{default:!0}});var b=n(y,2),g=n(b,2);g.__click=()=>{S.add_message({roomId:r.room.room_id,message:p()}),_.set("")};var s=n(g,2);s.__click=[_e,o];var u=n(s,2),m=c(u),$=c(m),w=n(m,2);Q(w,21,()=>se(r.room.messages),G,(i,P)=>{var f=ce(),N=c(f),z=c(N),B=n(N,2),I=c(B);K(()=>{h(z,k(P).created_date),h(I,k(P).text)}),v(i,f)});var O=n(u,2),F=c(O),q=c(F);K(i=>{h($,r.room.name),h(q,i)},[()=>JSON.stringify(o(),null,2)]),U(b,p,i=>V(_,i)),v(t,l),H(),e()}Y(["click"]);var ue=d('<!> <h1 class="text-rose-600">Комната не найдена</h1>',1),de=d('<h1 class="text-cyan-400 text-lg">Chat</h1> <!>',1);function ge(t,r){E(r,!0);const[a,e]=M(),o=()=>x(S,"$events_store",a),p=()=>x(re,"$routingStore",a);let _=X(null);ae(()=>{o(),ee(_,S.get_room_by_id(p().queryParams.get(te.ROOM_ID)),!0)});var l=de(),y=n(T(l),2);{var b=s=>{le(s,{get room(){return k(_)}})},g=s=>{var u=ue(),m=T(u);J(m,{className:"text-yellow-500",get href(){return j.CHAT_ROOMS},children:($,w)=>{var O=Z("back");v($,O)},$$slots:{default:!0}}),v(s,u)};W(y,s=>{k(_)?s(b):s(g,!1)})}v(t,l),H(),e()}export{ge as default};
