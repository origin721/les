import{J as t,N as p,M as s}from"./index-C4153gkO.js";import{d as I,e as A}from"./decrypt_curve25519_from_pass-BMc_o5KK.js";const m=2,S={version:2,name:"accounts_versioning",description:"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è version –∫–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º accounts",fileName:"2_accounts_versioning.ts"};function w(f){t("üì¶ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é —Å—Ö–µ–º—ã 2: –°—Ö–µ–º–∞ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è"),t("‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã 2 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")}async function O(f){const{db:v,currentUser:o}=f;return t(`üîÑ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö 2 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${o.id}`),new Promise((l,a)=>{try{const n=v.transaction(["accounts"],"readwrite"),$=n.objectStore("accounts"),c=$.getAll();c.onsuccess=async function(){try{const i=c.result.filter(e=>e.id===o.id);if(i.length===0){t(`‚úÖ –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.id}`),l();return}t(`üìã –ù–∞–π–¥–µ–Ω–æ ${i.length} –∑–∞–ø–∏—Å–µ–π –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏`);let r={total:i.length,processed:0,migrated:0,corrupted:0,foreign:0,alreadyVersioned:0,corruptedIds:[]},y=0;for(const e of i){r.processed++,p(`üîÑ –ú–∏–≥—Ä–∏—Ä—É–µ–º –∞–∫–∫–∞—É–Ω—Ç ${e.id} (${r.processed}/${r.total})`);const g=await I({pass:o.pass,cipherText:e.data});if(!g){r.corrupted++,r.corruptedIds.push(e.id),s(`üí• –ü–û–í–†–ï–ñ–î–ï–ù–ù–´–ï –î–ê–ù–ù–´–ï: accounts ${e.id} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.id}`);continue}const u=JSON.parse(g);if(u.version!==void 0){r.alreadyVersioned++,p(`‚è≠Ô∏è –ê–∫–∫–∞—É–Ω—Ç ${e.id} —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ version: ${u.version}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);continue}const _={...u,version:m,date_updated:new Date},h=await A({pass:o.pass,message:JSON.stringify(_)}),D={id:e.id,data:h};$.put(D),y++,r.migrated++,p(`‚úÖ –ê–∫–∫–∞—É–Ω—Ç ${e.id} –æ–±–Ω–æ–≤–ª–µ–Ω —Å version: ${m}`)}n.oncomplete=function(){t(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö 2 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.id}`),t("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ accounts:"),t(`   - –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${r.total}`),t(`   - –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${r.processed}`),t(`   - –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${r.migrated}`),t(`   - –£–∂–µ —Å –≤–µ—Ä—Å–∏–µ–π: ${r.alreadyVersioned}`),t(`   - –ß—É–∂–∏–µ –∑–∞–ø–∏—Å–∏: ${r.foreign}`),t(`   - –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ: ${r.corrupted}`),r.corruptedIds.length>0&&s("üí• ID –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π accounts:",r.corruptedIds),l()},n.onerror=function(){s(`‚ùå –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.id}:`,n.error),a(n.error)}}catch(d){s(`‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.id}:`,d),a(d)}},c.onerror=function(){s(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.id}:`,c.error),a(c.error)}}catch(n){s(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ migrationData –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.id}:`,n),a(n)}})}export{O as migrationData,S as migrationInfo,w as migrationScheme};
