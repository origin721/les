import{J as e,N as f,M as s}from"./index-Dq12CK1s.js";import{d as h,e as D}from"./decrypt_curve25519_from_pass-BrpdreTm.js";const g=1,w={version:1,name:"accounts_friends",description:"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è version –∫–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º friends",fileName:"1_accounts_friends.ts"};function R(p){e("üì¶ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é —Å—Ö–µ–º—ã 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤"),e("‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")}async function A(p){const{db:l,currentUser:t}=p;return e(`üîÑ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö 1 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${t.id}`),new Promise((u,c)=>{try{const n=l.transaction(["friends"],"readwrite"),$=n.objectStore("friends"),d=$.getAll();d.onsuccess=async function(){try{const i=d.result;if(i.length===0){e(`‚úÖ –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π friends –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.id}`),u();return}e(`üìã –ù–∞–π–¥–µ–Ω–æ ${i.length} –∑–∞–ø–∏—Å–µ–π friends –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏`);let r={total:i.length,processed:0,migrated:0,corrupted:0,foreign:0,alreadyVersioned:0,corruptedIds:[]},y=0;for(const o of i){r.processed++,f(`üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–∏—Å—å friends ${o.id} (${r.processed}/${r.total})`);const m=await h({pass:t.pass,cipherText:o.data});if(!m){r.corrupted++,r.corruptedIds.push(o.id),s(`üí• –ü–û–í–†–ï–ñ–î–ï–ù–ù–´–ï –î–ê–ù–ù–´–ï: friends ${o.id} –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞ ${t.id}`);continue}const a=JSON.parse(m);if(a.myAccId!==t.id){r.foreign++,f(`üë§ –ó–∞–ø–∏—Å—å friends ${o.id} –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (${a.myAccId}), –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);continue}if(a.version!==void 0){r.alreadyVersioned++,f(`‚è≠Ô∏è –ó–∞–ø–∏—Å—å friends ${o.id} —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ version: ${a.version}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);continue}const I={...a,version:g,date_updated:new Date},_=await D({pass:t.pass,message:JSON.stringify(I)}),v={id:o.id,data:_};$.put(v),y++,r.migrated++,f(`‚úÖ –ó–∞–ø–∏—Å—å friends ${o.id} –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å version: ${g}`)}n.oncomplete=function(){e(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.id}`),e("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ friends:"),e(`   - –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${r.total}`),e(`   - –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${r.processed}`),e(`   - –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${r.migrated}`),e(`   - –£–∂–µ —Å –≤–µ—Ä—Å–∏–µ–π: ${r.alreadyVersioned}`),e(`   - –ß—É–∂–∏–µ –∑–∞–ø–∏—Å–∏: ${r.foreign}`),e(`   - –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ: ${r.corrupted}`),r.corruptedIds.length>0&&s("üí• ID –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π friends:",r.corruptedIds),u()},n.onerror=function(){s(`‚ùå –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.id}:`,n.error),c(n.error)}}catch(i){s(`‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.id}:`,i),c(i)}},d.onerror=function(){s(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ friends –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.id}:`,d.error),c(d.error)}}catch(n){s(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ migrationData –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.id}:`,n),c(n)}})}export{A as migrationData,w as migrationInfo,R as migrationScheme};
