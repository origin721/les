import{w as a,M as u,v as d}from"./index-nyzUZv0R.js";const g=c();function c(){const s=a(f());function t(o){const r=d();return s.update(e=>{const n={...e.rooms,[r]:{name:o.name,room_id:r,messages:{}}};return{...e,rooms:n}}),{roomId:r}}const _=o=>{const r=d();s.update(e=>({...e,rooms:{...e.rooms,[o.roomId]:{...e.rooms[o.roomId],messages:{...e.rooms[o.roomId].messages,[r]:{text:o.message,created_date:new Date}}}}}))};function i(o){s.update(r=>{try{let e={...r,my_ids_for_server:r.my_ids_for_server||{}};return e.my_ids_for_server={...e.my_ids_for_server},delete e.my_ids_for_server[o.user_id],e}catch(e){return console.error(import.meta.url,e),r}})}function m(o){s.update(r=>{try{let e={...r,my_ids_for_server:r.my_ids_for_server||{}};return e.my_ids_for_server={...e.my_ids_for_server,[o.user_id]:o.user_id},e}catch(e){return console.error(import.meta.url,e),r}})}return{subscribe:s.subscribe,add_message:_,add_room:t,get_room_by_id:o=>Object.values(u(s).rooms).find(r=>r.room_id===o)||null,registration_by_id:m,delete_registration_by_id:i}}function b(s){return Object.values(s).sort((t,_)=>_.created_date.valueOf()-t.created_date.valueOf())}function f(){return{rooms:{},my_ids_for_server:{}}}export{g as e,b as m};
