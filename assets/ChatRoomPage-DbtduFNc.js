import{v as N,n as R,o as C,q as B,p as E,f as l,u as T,L as J,a as v,R as j,d as _,h as x,w as Q,c,x as U,y as K,z as h,g as G,l as V,j as H,k as M,A as Y,B as k,C as W,D as X,E as Z,t as ee,G as te,Q as re,r as ae}from"./index-a_Q9CJtS.js";import{r as se}from"./legacy-client-Bd_69wkc.js";import{e as S,m as oe}from"./events_store-Eun2ByB-.js";const D=Object.freeze({ping:"ping",server_event_registration:"server_event_registration",send_by_pub_key:"send_by_pub_key"}),_e={ping:"ping"};async function ne(t,r){let a;if(t.path===D.server_event_registration){const e=r,o=JSON.stringify({path:t.path,uuid:N(),created_date:new Date,body:{connection_id:t.body.connection_id,pub_key_ed25519_client:e.pub_key_ed25519_client}});a=await R({receiverPublicKey:e.pub_key_curve25519_server,message:JSON.stringify({payloadSignature:await C({receiverPublicKey:e.pub_key_curve25519_server,senderPrivateKey:e.priv_key_curve25519_client,message:o}),pub_key_curve25519_client:e.pub_key_curve25519_client})})}else if(t.path===D.send_by_pub_key){const e=r,o=JSON.stringify({path:t.path,uuid:N(),created_date:new Date,body:t.body});a=await R({receiverPublicKey:e.pub_key_curve25519_server,message:JSON.stringify({payloadSignature:await C({receiverPublicKey:e.pub_key_curve25519_server,senderPrivateKey:e.priv_key_curve25519_client,message:o}),pub_key_curve25519_client:e.pub_key_curve25519_client})})}else B("КРИТИЧЕСКАЯ ОШИБКА API: не существует метода для запроса",t);return fetch("/events",{method:"POST",headers:{"Content-Type":"application/json"},body:a})}function ie(t,r){ne({path:_e.ping,payload:{room_ids:Object.keys(r().rooms),message:"text",registration_id:"text",owner_id:"id",user_ids:[]}})}var ce=l("<p>back</p>"),ve=l("<div><p> </p> <p> </p> <hr/></div>"),ue=l('<!> <textarea class="bg-blue-900 text-blue-200"></textarea> <button class="text-teal-500">send message</button> <button>send</button> <div><h1 class="text-2xl text-cyan-400"> </h1> <div></div></div> <div><pre> </pre></div>',1);function de(t,r){E(r,!0);const[a,e]=M(),o=()=>x(S,"$events_store",a),p=()=>x(n,"$messageTextField",a);let n=Q("");var u=ue(),y=T(u);J(y,{className:"text-yellow-500",get href(){return j.CHAT_ROOMS},children:(i,O)=>{var f=ce();v(i,f)},$$slots:{default:!0}});var g=_(y,2),b=_(g,2);b.__click=()=>{S.add_message({roomId:r.room.room_id,message:p()}),n.set("")};var s=_(b,2);s.__click=[ie,o];var d=_(s,2),m=c(d),$=c(m),w=_(m,2);U(w,21,()=>oe(r.room.messages),W,(i,O)=>{var f=ve(),A=c(f),L=c(A),q=_(A,2),z=c(q);K(()=>{h(L,k(O).created_date),h(z,k(O).text)}),v(i,f)});var P=_(d,2),F=c(P),I=c(F);K(i=>{h($,r.room.name),h(I,i)},[()=>JSON.stringify(o(),null,2)]),G(g,p,i=>V(n,i)),v(t,u),H(),e()}Y(["click"]);var le=l('<!> <h1 class="text-rose-600">Комната не найдена</h1>',1),pe=l('<h1 class="text-cyan-400 text-lg">Chat</h1> <!>',1);function me(t,r){E(r,!0);const[a,e]=M(),o=()=>x(S,"$events_store",a),p=()=>x(ae,"$routingStore",a);let n=Z(null);se(()=>{o(),te(n,S.get_room_by_id(p().queryParams.get(re.ROOM_ID)),!0)});var u=pe(),y=_(T(u),2);{var g=s=>{de(s,{get room(){return k(n)}})},b=s=>{var d=le(),m=T(d);J(m,{className:"text-yellow-500",get href(){return j.CHAT_ROOMS},children:($,w)=>{var P=ee("back");v($,P)},$$slots:{default:!0}}),v(s,d)};X(y,s=>{k(n)?s(g):s(b,!1)})}v(t,u),H(),e()}export{me as default};
