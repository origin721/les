import{w as u,W as c,v as _}from"./index-D5xxotLR.js";const g=a();function a(){const s=u(f());function n(o){const r=_();return s.update(e=>{const t={...e.rooms,[r]:{name:o.name,room_id:r,messages:{}}};return{...e,rooms:t}}),{roomId:r}}const i=o=>{const r=_();s.update(e=>({...e,rooms:{...e.rooms,[o.roomId]:{...e.rooms[o.roomId],messages:{...e.rooms[o.roomId].messages,[r]:{text:o.message,created_date:new Date}}}}}))};function d(o){s.update(r=>{try{let e={...r,my_ids_for_server:r.my_ids_for_server||{}};return e.my_ids_for_server={...e.my_ids_for_server},delete e.my_ids_for_server[o.user_id],e}catch(e){return console.error(import.meta.url,e),r}})}function m(o){s.update(r=>{try{let e={...r,my_ids_for_server:r.my_ids_for_server||{}};return e.my_ids_for_server={...e.my_ids_for_server,[o.user_id]:o.user_id},e}catch(e){return console.error(import.meta.url,e),r}})}return{subscribe:s.subscribe,add_message:i,add_room:n,get_room_by_id:o=>Object.values(c(s).rooms).find(r=>r.room_id===o)||null,registration_by_id:m,delete_registration_by_id:d}}function f(){return{rooms:{},my_ids_for_server:{}}}export{g as e};
