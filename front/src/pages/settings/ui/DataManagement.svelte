<script lang="ts">
    import { Button } from "../../../components/ui";
    import {
        clearAllAppData,
        clearServiceWorkersOnly,
        clearStorageOnly,
        clearIndexedDBOnly,
    } from "../../../core/clear_app_data";
    import styles from "./SettingsPage.module.css";

    let showClearOptions = false;

    function toggleClearOptions() {
        showClearOptions = !showClearOptions;
    }

    async function handleClearAll() {
        if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")) {
            await clearAllAppData();
        }
    }

    async function handleClearServiceWorkers() {
        if (confirm("–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ Service Workers?")) {
            await clearServiceWorkersOnly();
        }
    }

    function handleClearStorage() {
        if (confirm("–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ?")) {
            clearStorageOnly();
        }
    }

    async function handleClearIndexedDB() {
        if (confirm("–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ IndexedDB –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?")) {
            await clearIndexedDBOnly();
        }
    }
</script>

<div class={styles.settingSection}>
    <h2 class={styles.sectionTitle}>üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h2>
    <div class={styles.settingItem}>
        <div class={styles.settingHeader}>
            <div class={styles.settingName}>
                <span class={styles.settingIcon}>üíΩ</span>
                –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            </div>
            <span class={`${styles.statusIndicator} ${styles.statusActive}`}>
                ‚óè –î–û–°–¢–£–ü–ù–û
            </span>
        </div>
        <div class={styles.settingDescription}>
            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∫—ç—à –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.
        </div>
        <div class={styles.settingActions}>
            <Button variant="outline" size="sm" onclick={toggleClearOptions}>
                {showClearOptions ? "–°–∫—Ä—ã—Ç—å –æ–ø—Ü–∏–∏" : "–ü–æ–∫–∞–∑–∞—Ç—å –æ–ø—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏"}
            </Button>
        </div>
        {#if showClearOptions}
            <div class={styles.clearOptions}>
                <Button variant="danger" size="sm" onclick={handleClearAll}>
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                </Button>
                <Button variant="outline" size="sm" onclick={handleClearServiceWorkers}>
                    üîß –û—á–∏—Å—Ç–∏—Ç—å Service Workers
                </Button>
                <Button variant="outline" size="sm" onclick={handleClearStorage}>
                    üíæ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                </Button>
                <Button variant="outline" size="sm" onclick={handleClearIndexedDB}>
                    üóÑÔ∏è –û—á–∏—Å—Ç–∏—Ç—å IndexedDB
                </Button>
            </div>
        {/if}
    </div>
</div>
