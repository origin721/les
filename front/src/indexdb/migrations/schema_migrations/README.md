# Система асинхронных миграций схемы IndexedDB

Эта система позволяет вынести создание схемы базы данных в отдельные модули с асинхронной загрузкой.

## Структура

```
src/indexdb/migrations/
├── schema_migrations.ts         # Основная логика загрузки и выполнения миграций
└── schema_migrations/
    ├── 0_initialization_clear.ts   # Начальная схема БД
    ├── 1_add_indexes_example.ts    # Пример расширения схемы
    └── README.md                   # Документация
```

## Схема именования

Файлы миграций должны следовать схеме: `{версия}_{название_на_английском}.ts`

Примеры:
- `0_initialization_clear.ts` - инициализация БД
- `1_add_indexes.ts` - добавление индексов
- `2_add_settings_store.ts` - добавление хранилища настроек

## Структура модуля миграции

```typescript
export async function migration_{версия}_{название}(db: IDBDatabase): Promise<void> {
  // Логика миграции
}

export const migrationInfo = {
  version: 0,
  name: 'название',
  description: 'Описание миграции',
  fileName: 'файл.ts'
};
```

## Добавление новой миграции

1. Создайте файл с правильным именем в папке `schema_migrations/`
2. Реализуйте функцию миграции и экспортируйте migrationInfo
3. Добавьте запись в `SCHEMA_MIGRATIONS_REGISTRY` в файле `schema_migrations.ts`
4. Увеличьте версию БД в `indexdb_wrapper.ts`

## Преимущества

- **Асинхронная загрузка**: модули загружаются только при необходимости
- **Модульность**: каждая миграция в отдельном файле
- **Расширяемость**: легко добавлять новые миграции
- **Читаемость**: понятная схема именования и структура

## Примечания

- Миграции выполняются последовательно от oldVersion до newVersion
- Каждая миграция загружается асинхронно только при необходимости
- Система использует версии IndexedDB для отслеживания схемы
