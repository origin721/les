# üìã –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ User-Centric Migration Architecture

## üéØ –¶–ï–õ–¨ –ó–ê–î–ê–ß–ò
–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–π IndexDB –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º. –†–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ **70%**, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ **30%** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

---

## üîç –ü–û–õ–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê

### –ò—Å—Ö–æ–¥–Ω–∞—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞
**–ü–†–û–ë–õ–ï–ú–ê:** –ú–∏–≥—Ä–∞—Ü–∏–∏ IndexDB "–∑–∞–≤–∏—Å–∞–ª–∏" –∏ –º–æ–≥–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞–≤—Å–µ–≥–¥–∞, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ–ª–Ω–æ–π –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
1. **–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º**
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ü—Ä–∏ `login(password)` —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `Account.id`

2. **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
   - –û–¥–∏–Ω –ø–∞—Ä–æ–ª—å –º–æ–∂–µ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
   - –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `accounts_service.onLogin()`

3. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
   - –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ú–∏–≥—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏
   - –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–ê–Ø –†–ê–ë–û–¢–ê (70% –≥–æ—Ç–æ–≤–æ)

### 1. –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
**–§–∞–π–ª—ã:** 
- `src/indexdb/db_state_manager_v1/constants.ts`
- `src/indexdb/db_state_manager_v1/db_state_manager.ts`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `DbStateRecord` —Å –ø–æ–ª—è–º–∏ –≤—Ä–µ–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–π
- –§—É–Ω–∫—Ü–∏–∏ `startMigrationTimer()`, `endMigrationTimer()`
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ú–∞—Å—Å–∏–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

### 2. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
**–§–∞–π–ª:** `src/indexdb/main_les_store_v1/recovery_manager.ts`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `RecoveryManager.checkOnAppStart()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- `recoverFromIncompleteUpdate()` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- –î–µ—Ç–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π (>10 –º–∏–Ω—É—Ç)
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

### 3. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π
**–§–∞–π–ª:** `src/indexdb/main_les_store_v1/version_manager.ts`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `VersionManager.addVersionToAllRecords()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
- `validateRecordVersions()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –∑–∞–ø–∏—Å—è—Ö

### 4. Promise-based Connection Manager
**–§–∞–π–ª:** `src/indexdb/main_les_store_v1/connection_manager.ts`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –æ—Ç lifecycle –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- Promise-based –ø–æ–¥—Ö–æ–¥ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 5. –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π IndexDB Wrapper
**–§–∞–π–ª:** `src/indexdb/main_les_store_v1/indexdb_wrapper.ts`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å ~400 –¥–æ ~85 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- –ü—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π wrapper –¥–ª—è legacy-–∫–æ–¥–∞
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏

### 6. üîí –†–ï–®–ï–ù–ê –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ–ª—å—à–µ –ù–ï –ú–û–ñ–ï–¢ "–∑–∞–≤–∏—Å–Ω—É—Ç—å" –Ω–∞–≤—Å–µ–≥–¥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- –ù–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

## ‚ùå –¢–†–ï–ë–£–ï–ú–´–ï –î–û–†–ê–ë–û–¢–ö–ò (30% –æ—Å—Ç–∞–ª–æ—Å—å)

### –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ù–ï –£–ß–ò–¢–´–í–ê–ï–¢ –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫—É:**
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ, –∞ –Ω–µ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏  
- –ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `migrationData` —Ñ—É–Ω–∫—Ü–∏—è—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã (–Ω—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

---

## üõ†Ô∏è –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠–¢–ê–ü 1: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Ñ–∞–π–ª—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)

#### 1.1 –û–±–Ω–æ–≤–∏—Ç—å constants.ts
**–§–∞–π–ª:** `src/indexdb/db_state_manager_v1/constants.ts`

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:

```typescript
/**
 * –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
export interface MigrationContext {
  db: IDBDatabase;
  currentUser: {
    id: string;        // Account.id –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö  
    pass: string;      // –ü–∞—Ä–æ–ª—å –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
  };
  oldVersion: number;
  newVersion: number;
}

/**
 * –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
export interface UserMigrationRecord {
  userId: string;                    // Account.id
  currentVersion: number;            // —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ë–î –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  completedMigrations: number[];     // –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ [1,2,3,4]
  migrationHistory: Array<{
    version: number;
    fileName: string;
    schemaDuration: number;
    dataDuration: number;
    startTime: number;
    endTime: number;
  }>;
  migrationStartTime?: number;
  migrationEndTime?: number;
  migrationDurationMs?: number;
  errorMessage?: string;
  migratedTables?: string[];
}

/**
 * –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
 */
export const USER_MIGRATION_CONSTANTS = {
  DB_NAME: 'DB_STATE_MANAGER_V2',     // –ù–æ–≤–∞—è –±–∞–∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π v2
  STORE_NAME: 'user_migration_states', // Store –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  VERSION: 1,
} as const;
```

#### 1.2 –°–æ–∑–¥–∞—Ç—å UserStateManager
**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `src/indexdb/db_state_manager_v1/user_state_manager.ts`

```typescript
import { USER_MIGRATION_CONSTANTS, type UserMigrationRecord } from './constants';

/**
 * –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
 * –ë–∞–∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤–µ—Ä—Å–∏–∏ 2 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
 */
export class UserStateManager {
  private static dbPromise: Promise<IDBDatabase> | null = null;

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π —Å–æ—Å—Ç–æ—è–Ω–∏–π v2
   */
  private static async getDatabase(): Promise<IDBDatabase> {
    if (!this.dbPromise) {
      this.dbPromise = new Promise((resolve, reject) => {
        const request = indexedDB.open(USER_MIGRATION_CONSTANTS.DB_NAME, USER_MIGRATION_CONSTANTS.VERSION);
        
        request.onupgradeneeded = (event) => {
          const db = (event.target as IDBOpenDBRequest).result;
          
          if (!db.objectStoreNames.contains(USER_MIGRATION_CONSTANTS.STORE_NAME)) {
            const store = db.createObjectStore(USER_MIGRATION_CONSTANTS.STORE_NAME, { keyPath: 'userId' });
            store.createIndex('userId', 'userId', { unique: true });
            store.createIndex('currentVersion', 'currentVersion', { unique: false });
          }
        };
        
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }
    return this.dbPromise;
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  static async getUserState(userId: string): Promise<UserMigrationRecord | null> {
    const db = await this.getDatabase();
    return new Promise((resolve, reject) => {
      const transaction = db.transaction([USER_MIGRATION_CONSTANTS.STORE_NAME], 'readonly');
      const store = transaction.objectStore(USER_MIGRATION_CONSTANTS.STORE_NAME);
      const request = store.get(userId);
      
      request.onsuccess = () => resolve(request.result || null);
      request.onerror = () => reject(request.error);
    });
  }

  /**
   * –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  static async updateUserState(userId: string, record: Partial<UserMigrationRecord>): Promise<void> {
    const db = await this.getDatabase();
    const existingRecord = await this.getUserState(userId) || {
      userId,
      currentVersion: 0,
      completedMigrations: [],
      migrationHistory: []
    };

    const updatedRecord: UserMigrationRecord = { ...existingRecord, ...record };

    return new Promise((resolve, reject) => {
      const transaction = db.transaction([USER_MIGRATION_CONSTANTS.STORE_NAME], 'readwrite');
      const store = transaction.objectStore(USER_MIGRATION_CONSTANTS.STORE_NAME);
      const request = store.put(updatedRecord);
      
      request.onsuccess = () => resolve();
      request.onerror = () => reject(request.error);
    });
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
   */
  static async getUsersCompletedVersion(version: number): Promise<string[]> {
    const db = await this.getDatabase();
    return new Promise((resolve, reject) => {
      const transaction = db.transaction([USER_MIGRATION_CONSTANTS.STORE_NAME], 'readonly');
      const store = transaction.objectStore(USER_MIGRATION_CONSTANTS.STORE_NAME);
      const request = store.getAll();
      
      request.onsuccess = () => {
        const records: UserMigrationRecord[] = request.result;
        const completedUsers = records
          .filter(record => record.completedMigrations.includes(version))
          .map(record => record.userId);
        resolve(completedUsers);
      };
      request.onerror = () => reject(request.error);
    });
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π
   */
  static async getAllSystemUserIds(): Promise<string[]> {
    const db = await this.getDatabase();
    return new Promise((resolve, reject) => {
      const transaction = db.transaction([USER_MIGRATION_CONSTANTS.STORE_NAME], 'readonly');
      const store = transaction.objectStore(USER_MIGRATION_CONSTANTS.STORE_NAME);
      const request = store.getAllKeys();
      
      request.onsuccess = () => resolve(request.result as string[]);
      request.onerror = () => reject(request.error);
    });
  }
}
```

### –≠–¢–ê–ü 2: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

#### 2.1 –°–æ–∑–¥–∞—Ç—å UserMigrationManager
**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `src/indexdb/main_les_store_v1/user_migration_manager.ts`

```typescript
import { UserStateManager } from '../db_state_manager_v1/user_state_manager';
import { getAllMigrations } from './migrations/MIGRATIONS_REGISTRY';
import type { MigrationContext, UserMigrationRecord } from '../db_state_manager_v1/constants';

/**
 * –ú–µ–Ω–µ–¥–∂–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
 * –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
 */
export class UserMigrationManager {
  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  static async checkUserMigrations(userId: string): Promise<number[]> {
    const userState = await UserStateManager.getUserState(userId);
    const currentVersion = userState?.currentVersion || 0;
    
    const allMigrations = await getAllMigrations();
    const maxVersion = Math.max(...allMigrations.map(m => m.version));
    
    const neededMigrations: number[] = [];
    for (let version = currentVersion + 1; version <= maxVersion; version++) {
      if (!userState?.completedMigrations?.includes(version)) {
        neededMigrations.push(version);
      }
    }
    
    return neededMigrations;
  }

  /**
   * –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  static async migrateUser(context: MigrationContext): Promise<void> {
    const { currentUser, db, oldVersion, newVersion } = context;
    const userId = currentUser.id;
    
    console.log(`üîÑ –ù–∞—á–∏–Ω–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId} —Å –≤–µ—Ä—Å–∏–∏ ${oldVersion} –¥–æ ${newVersion}`);
    
    // –û—Ç–º–µ—Ç–∏—Ç—å –Ω–∞—á–∞–ª–æ –º–∏–≥—Ä–∞—Ü–∏–∏
    await UserStateManager.updateUserState(userId, {
      migrationStartTime: Date.now(),
      currentVersion: oldVersion
    });

    try {
      const neededMigrations = await this.checkUserMigrations(userId);
      
      for (const version of neededMigrations) {
        if (version > newVersion) break;
        
        await this.executeUserMigration(context, version);
        
        // –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
        const userState = await UserStateManager.getUserState(userId) || {
          userId,
          currentVersion: oldVersion,
          completedMigrations: [],
          migrationHistory: []
        };
        
        await UserStateManager.updateUserState(userId, {
          currentVersion: version,
          completedMigrations: [...userState.completedMigrations, version]
        });
      }

      // –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
      await UserStateManager.updateUserState(userId, {
        migrationEndTime: Date.now(),
        currentVersion: newVersion
      });

      console.log(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ`);
      
    } catch (error) {
      console.error(`‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
      
      await UserStateManager.updateUserState(userId, {
        migrationEndTime: Date.now(),
        errorMessage: error instanceof Error ? error.message : 'Unknown error'
      });
      
      throw error;
    }
  }

  /**
   * –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  private static async executeUserMigration(context: MigrationContext, version: number): Promise<void> {
    const { currentUser } = context;
    
    console.log(`üì¶ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –≤–µ—Ä—Å–∏–∏ ${version} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentUser.id}`);
    
    const startTime = Date.now();
    
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
    const allMigrations = await getAllMigrations();
    const migration = allMigrations.find(m => m.version === version);
    
    if (!migration) {
      throw new Error(`–ú–∏–≥—Ä–∞—Ü–∏—è –≤–µ—Ä—Å–∏–∏ ${version} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
    }

    // –í—ã–ø–æ–ª–Ω–∏—Ç—å migrationData —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (migration.migrationData) {
      await migration.migrationData(context);
    }
    
    const endTime = Date.now();
    const duration = endTime - startTime;
    
    console.log(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –≤–µ—Ä—Å–∏–∏ ${version} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentUser.id} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${duration}–º—Å`);
    
    // –ó–∞–ø–∏—Å–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é
    const userState = await UserStateManager.getUserState(currentUser.id);
    if (userState) {
      const historyEntry = {
        version,
        fileName: migration.fileName || `migration_${version}`,
        schemaDuration: 0, // Schema —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ
        dataDuration: duration,
        startTime,
        endTime
      };
      
      await UserStateManager.updateUserState(currentUser.id, {
        migrationHistory: [...userState.migrationHistory, historyEntry]
      });
    }
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –í–°–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ—à–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é (–¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü)
   */
  static async allUsersCompletedVersion(version: number): Promise<boolean> {
    // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ accounts —Ç–∞–±–ª–∏—Ü—ã
    const allSystemUserIds = await this.scanAllUserIds();
    
    // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö –≤–µ—Ä—Å–∏—é
    const completedUserIds = new Set(await UserStateManager.getUsersCompletedVersion(version));
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–∑–º–µ—Ä—ã —Ä–∞–≤–Ω—ã –ò –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç
    return allSystemUserIds.size === completedUserIds.size && 
           [...allSystemUserIds].every(id => completedUserIds.has(id));
  }

  /**
   * –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å accounts —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   */
  private static async scanAllUserIds(): Promise<Set<string>> {
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ accounts —Ç–∞–±–ª–∏—Ü—ã
    // –≠—Ç–æ –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–∞—à–µ–π accounts —Ç–∞–±–ª–∏—Ü—ã
    throw new Error('scanAllUserIds() —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É accounts');
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  static async getUserMigrationStats(userId: string): Promise<UserMigrationRecord | null> {
    return await UserStateManager.getUserState(userId);
  }
}
```

#### 2.2 –°–æ–∑–¥–∞—Ç—å AllUsersChecker
**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `src/indexdb/main_les_store_v1/all_users_checker.ts`

```typescript
import { UserStateManager } from '../db_state_manager_v1/user_state_manager';

/**
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü
 */
export class AllUsersChecker {
  /**
   * –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å accounts —Ç–∞–±–ª–∏—Ü—É, –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ
   */
  static async scanAllUserIds(db: IDBDatabase): Promise<Set<string>> {
    return new Promise((resolve, reject) => {
      const transaction = db.transaction(['accounts'], 'readonly');
      const store = transaction.objectStore('accounts');
      const request = store.getAll();
      
      request.onsuccess = () => {
        const accounts = request.result;
        const userIds = new Set(accounts.map((account: any) => account.id));
        resolve(userIds);
      };
      
      request.onerror = () => reject(request.error);
    });
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
   */
  static async allUsersReady(db: IDBDatabase, version: number): Promise<boolean> {
    try {
      // 1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ accounts —Ç–∞–±–ª–∏—Ü—ã
      const allSystemUserIds = await this.scanAllUserIds(db);
      
      // 2. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏—é
      const completedUserIds = new Set(await UserStateManager.getUsersCompletedVersion(version));
      
      // 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–∑–º–µ—Ä—ã —Ä–∞–≤–Ω—ã –ò –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç
      const result = allSystemUserIds.size === completedUserIds.size && 
                     [...allSystemUserIds].every(id => completedUserIds.has(id));
      
      console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –≤–µ—Ä—Å–∏–∏ ${version}:`);
      console.log(`   - –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: ${allSystemUserIds.size}`);
      console.log(`   - –ó–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏—é: ${completedUserIds.size}`);
      console.log(`   - –†–µ–∑—É–ª—å—Ç–∞—Ç: ${result ? '‚úÖ –í—Å–µ –≥–æ—Ç–æ–≤—ã' : '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ'}`);
      
      return result;
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
      return false;
    }
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é
   */
  static async getPendingUsers(db: IDBDatabase, version: number): Promise<string[]> {
    const allSystemUserIds = await this.scanAllUserIds(db);
    const completedUserIds = new Set(await UserStateManager.getUsersCompletedVersion(version));
    
    return [...allSystemUserIds].filter(id => !completedUserIds.has(id));
  }
}
```

### –≠–¢–ê–ü 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

#### 3.1 –û–±–Ω–æ–≤–∏—Ç—å types.ts
**–§–∞–π–ª:** `src/indexdb/main_les_store_v1/migrations/types.ts`

```typescript
// –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
import type { MigrationContext } from '../../db_state_manager_v1/constants';

// –°–¢–ê–†–´–ï —Ç–∏–ø—ã (–£–ë–†–ê–¢–¨):
// export type MigrationFunction = (db: IDBDatabase) => void | Promise<void>;

// –ù–û–í–´–ï —Ç–∏–ø—ã:
export type MigrationFunction = (context: MigrationContext) => void | Promise<void>;
export type AsyncMigrationFunction = (context: MigrationContext) => Promise<void>;

// –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ schema migrations (–æ–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏)
export type SchemaMigrationFunction = (db: IDBDatabase) => void | Promise<void>;

export interface MigrationInfo {
  version: number;
  fileName?: string;
  description: string;
}

export interface Migration {
  migrationInfo: MigrationInfo;
  migrationScheme?: SchemaMigrationFunction;  // –ì–ª–æ–±–∞–ª—å–Ω–∞—è schema
  migrationData?: MigrationFunction;          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω–∞—è data
  version: number;
  fileName?: string;
}
```

### –≠–¢–ê–ü 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π

#### 4.1 –û–±–Ω–æ–≤–∏—Ç—å –í–°–ï migrationData —Ñ—É–Ω–∫—Ü–∏–∏
**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:** –í—Å–µ —Ñ–∞–π–ª—ã –≤ `src/indexdb/main_les_store_v1/migrations/combined/`

**–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (`src/indexdb/main_les_store_v1/migrations/combined/1_accounts_friends.ts`):

```typescript
// –ë–´–õ–û:
async function migrationData(db: IDBDatabase) {
  // –†–∞–±–æ—Ç–∞ —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const transaction = db.transaction(['accounts'], 'readwrite');
  const store = transaction.objectStore('accounts');
  // ...
}

// –°–¢–ê–õ–û:
async function migrationData(context: MigrationContext) {
  const { db, currentUser } = context;
  
  console.log(`üîÑ –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${currentUser.id}`);
  
  const transaction = db.transaction(['accounts'], 'readwrite');
  const store = transaction.objectStore('accounts');
  
  // –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userAccounts = await new Promise<any[]>((resolve, reject) => {
    const request = store.getAll();
    request.onsuccess = () => {
      const allAccounts = request.result;
      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ currentUser.id
      const filtered = allAccounts.filter(account => account.id === currentUser.id);
      resolve(filtered);
    };
    request.onerror = () => reject(request.error);
  });
  
  // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  for (const account of userAccounts) {
    // –î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å currentUser.pass
    // –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
  }
  
  console.log(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${currentUser.id} –∑–∞–≤–µ—Ä—à–µ–Ω–∞`);
}
```

**–í–ê–ñ–ù–û:** –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –í–°–ï —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `combined/`:
- `0_initialization.ts`
- `1_accounts_friends.ts` 
- –ò –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ existing –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠–¢–ê–ü 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

#### 5.1 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ accounts_service
**–§–∞–π–ª:** `src/local_back/modules/accounts_service.ts` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π)

```typescript
import { UserMigrationManager } from '../../../indexdb/main_les_store_v1/user_migration_manager';
import { ConnectionManager } from '../../../indexdb/main_les_store_v1/connection_manager';
import { getMaxVersion } from '../../../indexdb/main_les_store_v1/migrations/MIGRATIONS_REGISTRY';

// –í —Ñ—É–Ω–∫—Ü–∏–∏ onLogin():
async function onLogin(props: { body: { pass: string } }) {
  const password = props.body.pass;
  
  // 1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã –ø–æ –ø–∞—Ä–æ–ª—é (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)
  const accounts = await login(password);
  
  // 2. –ù–û–í–û–ï: –î–ª—è –ö–ê–ñ–î–û–ì–û –∞–∫–∫–∞—É–Ω—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
  console.log(`üîë –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è ${accounts.length} –∞–∫–∫–∞—É–Ω—Ç–æ–≤`);
  
  for (const account of accounts) {
    try {
      // –ü–æ–ª—É—á–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î
      const db = await ConnectionManager.getConnection();
      
      // –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const currentUserVersion = await UserMigrationManager.getUserMigrationStats(account.id);
      const oldVersion = currentUserVersion?.currentVersion || 0;
      const newVersion = await getMaxVersion();
      
      // –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      if (oldVersion < newVersion) {
        await UserMigrationManager.migrateUser({
          db,
          currentUser: { 
            id: account.id, 
            pass: password 
          },
          oldVersion,
          newVersion
        });
        
        console.log(`‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${account.id} –∑–∞–≤–µ—Ä—à–µ–Ω—ã`);
      } else {
        console.log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${account.id} —É–∂–µ –∞–∫—Ç—É–∞–ª–µ–Ω (–≤–µ—Ä—Å–∏—è ${oldVersion})`);
      }
      
    } catch (error) {
      console.error(`‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${account.id}:`, error);
      // –í–ê–ñ–ù–û: –†–µ—à–∏—Ç—å —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      // –í–∞—Ä–∏–∞–Ω—Ç—ã: 1) –ü—Ä–µ—Ä–≤–∞—Ç—å –≤–µ—Å—å login, 2) –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, 3) Retry
      throw error; // –ü–æ–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å
    }
  }
  
  // 3. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø
  console.log(`üéâ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã, —Ä–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ ${accounts.length} –∞–∫–∫–∞—É–Ω—Ç–∞–º`);
  return accounts;
}
```

### –≠–¢–ê–ü 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ConnectionManager

#### 6.1 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å UserMigrationManager
**–§–∞–π–ª:** `src/indexdb/main_les_store_v1/connection_manager.ts`

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫:

```typescript
import { UserMigrationManager } from './user_migration_manager';
import { AllUsersChecker } from './all_users_checker';

export class ConnectionManager {
  // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è...
  
  /**
   * –ù–û–í–´–ô –ú–ï–¢–û–î: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
   */
  static async checkMigrationReadiness(): Promise<{
    isReady: boolean;
    pendingUsers: string[];
    systemStatus: 'ready' | 'partial' | 'blocked';
  }> {
    try {
      const db = await this.getConnection();
      const maxVersion = await getMaxVersion();
      
      const isReady = await AllUsersChecker.allUsersReady(db, maxVersion);
      const pendingUsers = await AllUsersChecker.getPendingUsers(db, maxVersion);
      
      return {
        isReady,
        pendingUsers,
        systemStatus: isReady ? 'ready' : (pendingUsers.length > 0 ? 'partial' : 'blocked')
      };
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–π:', error);
      return {
        isReady: false,
        pendingUsers: [],
        systemStatus: 'blocked'
      };
    }
  }
  
  /**
   * –ù–û–í–´–ô –ú–ï–¢–û–î: –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   */
  static async getUsersMigrationSummary(): Promise<{
    totalUsers: number;
    migratedUsers: number;
    pendingUsers: string[];
    completionPercentage: number;
  }> {
    try {
      const db = await this.getConnection();
      const maxVersion = await getMaxVersion();
      
      const allSystemUserIds = await AllUsersChecker.scanAllUserIds(db);
      const completedUserIds = new Set(await UserStateManager.getUsersCompletedVersion(maxVersion));
      const pendingUsers = [...allSystemUserIds].filter(id => !completedUserIds.has(id));
      
      return {
        totalUsers: allSystemUserIds.size,
        migratedUsers: completedUserIds.size,
        pendingUsers,
        completionPercentage: allSystemUserIds.size > 0 ? 
          Math.round((completedUserIds.size / allSystemUserIds.size) * 100) : 100
      };
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
      return {
        totalUsers: 0,
        migratedUsers: 0,
        pendingUsers: [],
        completionPercentage: 0
      };
    }
  }
}
```

### –≠–¢–ê–ü 7: –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞

#### 7.1 –£–¥–∞–ª–∏—Ç—å indexdb_order
**–§–∞–π–ª:** `src/indexdb/main_les_store_v1/indexdb_order.ts` - **–£–î–ê–õ–ò–¢–¨ –ü–û–õ–ù–û–°–¢–¨–Æ**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –°–∏—Å—Ç–µ–º–∞ `create_promise_order` –∏ `indexdb_order` –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ UserMigrationManager
- –ú–∏–≥—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –±–ª–æ–∫–∏—Ä—É—é—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–µ –≤—Å—é —Å–∏—Å—Ç–µ–º—É
- Promise-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

#### 7.2 –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã
–í–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö, –≥–¥–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è `indexdb_order`, –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

---

## üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### 1. –ê–ª–≥–æ—Ä–∏—Ç–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü
```typescript
async function canSafelyDropTable(version: number): Promise<boolean> {
  // 1. –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å accounts —Ç–∞–±–ª–∏—Ü—É ‚Üí –≤—Å–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  const allSystemUserIds = await AllUsersChecker.scanAllUserIds(db);
  
  // 2. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö –º–∏–≥—Ä–∞—Ü–∏—é  
  const completedUserIds = await UserStateManager.getUsersCompletedVersion(version);
  
  // 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ä–∞–∑–º–µ—Ä—ã —Ä–∞–≤–Ω—ã –ò –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç
  return allSystemUserIds.size === completedUserIds.size && 
         [...allSystemUserIds].every(id => completedUserIds.has(id));
}
```

### 2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```
login(pass) ‚Üí –Ω–∞–π—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ö–ê–ñ–î–û–ì–û ‚Üí –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
```
**–í–ê–ñ–ù–û:** –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç –Ω–µ —É–¥–∞–ª–æ—Å—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ‚Üí –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω

### 3. –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **Schema migrations**: –≥–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ë–î (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- **Data migrations**: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å**: —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–∏–≥—Ä–∏—Ä—É—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –∑–∞–ø–∏—Å–∞—Ç—å –≤ `errorMessage`
- –†–µ—à–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É: –ø—Ä–µ—Ä–≤–∞—Ç—å –≤–µ—Å—å login –∏–ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º retry –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

---

## üìù –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è)
1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `src/indexdb/db_state_manager_v1/constants.ts` —Å –Ω–æ–≤—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å `src/indexdb/db_state_manager_v1/user_state_manager.ts`  
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É `DB_STATE_MANAGER_V2` —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –§–∞–∑–∞ 2: –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å `src/indexdb/main_les_store_v1/user_migration_manager.ts`
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å `src/indexdb/main_les_store_v1/all_users_checker.ts`
6. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `src/indexdb/main_les_store_v1/migrations/types.ts`

### –§–∞–∑–∞ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (–º–∞—Å—Å–æ–≤–∞—è)
7. ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û:** –û–±–Ω–æ–≤–∏—Ç—å –í–°–ï —Ñ—É–Ω–∫—Ü–∏–∏ `migrationData` –≤ `combined/`
   - –ó–∞–º–µ–Ω–∏—Ç—å `(db: IDBDatabase)` –Ω–∞ `(context: MigrationContext)`
   - –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ `currentUser.id`
   - –î–æ–±–∞–≤–∏—Ç—å –¥–µ—à–∏—Ñ—Ä–æ–≤–∫—É —Å `currentUser.pass`

### –§–∞–∑–∞ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–¥–µ–ª–∏–∫–∞—Ç–Ω–∞—è)
8. ‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `src/local_back/modules/accounts_service.ts`
9. ‚ö†Ô∏è –û–±–Ω–æ–≤–∏—Ç—å `src/indexdb/main_les_store_v1/connection_manager.ts`
10. ‚úÖ –£–¥–∞–ª–∏—Ç—å `src/indexdb/main_les_store_v1/indexdb_order.ts`

### –§–∞–∑–∞ 5: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
11. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `docs/indexdb/`
12. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
13. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–û–ú–ï–ù–¢–´

### 1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**
```typescript
// –í –∫–∞–∂–¥–æ–π migrationData —Ñ—É–Ω–∫—Ü–∏–∏:
const userRecords = allRecords.filter(record => record.userId === currentUser.id);
```

### 2. **–î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å –ø–∞—Ä–æ–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å currentUser.pass –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏:
const decryptedData = await decrypt(encryptedData, currentUser.pass);
```

### 3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–π**
- –ù–ï –¥–∞–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∞—É–¥–∏—Ç–∞

### 4. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –Ω–µ –ª–æ–º–∞—Ç—å –¥—Ä—É–≥–∏—Ö
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —É—Å–ø–µ—à–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã:
1. ‚úÖ **100% –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
2. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º**  
3. ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
4. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
5. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü**
6. ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**
7. ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤**

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (—Ç–æ–ª—å–∫–æ data migrations –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –¥–æ—Å—Ç—É–ø –∫ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –∞—É–¥–∏—Ç–∞

---

## üîó –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò

### –§–∞–π–ª—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
1. **`docs/indexdb/README.md`** - –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
2. **`docs/indexdb/migrations.md`** - –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å MigrationContext
3. **`docs/indexdb/state-management.md`** - –æ–ø–∏—Å–∞—Ç—å UserStateManager
4. **`docs/indexdb/examples.md`** - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ù–æ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
1. **–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π** - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–π** - —Ä–∞–±–æ—Ç–∞ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
4. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –æ—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ 30%** —Ä–∞–±–æ—Ç—ã –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã IndexDB –º–∏–≥—Ä–∞—Ü–∏–π. **–û—Å–Ω–æ–≤–∞ —É–∂–µ –∑–∞–ª–æ–∂–µ–Ω–∞ (70%)**, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥ –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ü–µ–Ω—Ç—Ä–∏—á–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–∏–≥—Ä–∏—Ä—É–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö  
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å:
`UserStateManager` ‚Üí `UserMigrationManager` ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `migrationData` ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 3-5 –¥–Ω–µ–π (–ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏)

---

*–¢–µ—Ö–∑–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ: 6 —è–Ω–≤–∞—Ä—è 2025*  
*–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: 70% –≥–æ—Ç–æ–≤–æ, 30% —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏*  
*–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)*
