# ๐ฏ ะะะฃะะฌะฏ API - ะะะะะะจะะะะะฏ ะะะะะะะะฆะะฏ

## โ ะกะขะะขะฃะก: ะะะะะะกะขะฌะฎ ะะะะะะจะะะ

### ๐ ะงะขะ ะะซะะ ะะะะะะะะะะะ

#### 1. **API ะกะปะพะน ะดะปั ะััะทะตะน** (`src/api/index.ts`)
```typescript
api.friends.getList()                    // ะะพะปััะธัั ะฒัะตั ะดััะทะตะน  
api.friends.getByAccountId(myAccId)      // ะััะทัั ะฟะพ ID ะฐะบะบะฐัะฝัะฐ
api.friends.getById(friendId)            // ะััะณ ะฟะพ ID
api.friends.add(friendsList)             // ะะพะฑะฐะฒะธัั ะดััะทะตะน
api.friends.delete(friendsIds)           // ะฃะดะฐะปะธัั ะดััะทะตะน
```

#### 2. **ะะฑะฝะพะฒะปะตะฝะฝัะน UI** (`src/pages/friends/ui/FriendsPage.svelte`)
- โ ะะฐะผะตะฝะธะป ะฟััะผัะต ะฒัะทะพะฒั IndexedDB ะฝะฐ API ัะตัะตะท shared worker
- โ ะัะฟะพะปัะทัะตั `api.friends.getList()` ะดะปั ะทะฐะณััะทะบะธ ะดะฐะฝะฝัั
- โ ะัะฟะพะปัะทัะตั `api.friends.delete([friendId])` ะดะปั ัะดะฐะปะตะฝะธั

#### 3. **ะััะธัะตะบัััะฝะฐั ะกัะตะผะฐ**
```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   FRONTEND      โโโโโถโ  SHARED WORKER   โโโโโถโ   INDEXEDDB     โ
โ  (FriendsPage)  โ    โ   (local_back)   โ    โ   (friends/)    โ
โ                 โ    โ                  โ    โ                 โ
โ api.friends.*() โ    โ friends_service  โ    โ get_friends()   โ
โ                 โ    โ middleware.ts    โ    โ add_friend()    โ
โ                 โ    โ back_store.ts    โ    โ delete_friend() โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

### ๐ ะะะะะะะกะะะกะขะฌ ะ ะจะะคะะะะะะะ

#### **ะััะทัั ะดะฐะฝะฝัะต (FriendEntity):**
- **id**: `string` (UUID ะณะตะฝะตัะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
- **namePub**: `string` (ะฟัะฑะปะธัะฝะพะต ะธะผั ะดััะณะฐ)  
- **myAccId**: `string` (ID ะฐะบะบะฐัะฝัะฐ ะฒะปะฐะดะตะปััะฐ)
- **friendPubKeyLibp2p**: `string` (ะบะปัั ะดะปั P2P ัะพะตะดะธะฝะตะฝะธั)

#### **ะะฐััะธััะพะฒะบะฐ ะดะฐะฝะฝัั:**
- โ ะัะต ะดะฐะฝะฝัะต ะทะฐัะธััะพะฒะฐะฝั ะฒ IndexedDB ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Curve25519
- โ ะะปััะธ ะฝะฐัะพะดัััั ัะพะปัะบะพ ะฒ ัะปะพะต `local_back` (shared worker)
- โ ะะฐััะธััะพะฒะบะฐ ะฟัะพะธััะพะดะธั ะฒ `get_friends()` ั ะฟะตัะตะฑะพัะพะผ ะฟะฐัะพะปะตะน ะฐะบะบะฐัะฝัะพะฒ
- โ ะคัะพะฝัะตะฝะด ะฟะพะปััะฐะตั ัะถะต ัะฐััะธััะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต ัะตัะตะท API

### ๐ ะขะะฅะะะงะะกะะะ ะะะขะะะ

#### **Middleware ะฟััะธ:**
```typescript
PATHS.GET_FRIENDS              // ะัะต ะดััะทัั
PATHS.GET_FRIENDS_BY_ACCOUNT_ID // ะะพ ID ะฐะบะบะฐัะฝัะฐ  
PATHS.GET_FRIEND_BY_ID         // ะะพ ID ะดััะณะฐ
PATHS.ADD_FRIENDS              // ะะพะฑะฐะฒะธัั
PATHS.DELETE_FRIENDS           // ะฃะดะฐะปะธัั
```

#### **Broadcast ัะพะฑััะธั:**
- โ `FrontMiddlewareActions.ADD_FRIENDS` - ัะฒะตะดะพะผะปะตะฝะธะต ะพ ะฝะพะฒัั ะดััะทััั
- โ `FrontMiddlewareActions.DELETE_FRIENDS` - ัะฒะตะดะพะผะปะตะฝะธะต ะพะฑ ัะดะฐะปะตะฝะธะธ

#### **ะััะธัะพะฒะฐะฝะธะต:**
- โ `back_store.friends_by_account` - ะบัั ะดััะทะตะน ะฟะพ ะฐะบะบะฐัะฝัะฐะผ
- โ ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ะฟะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั/ัะดะฐะปะตะฝะธั

### ๐จ UI ะะกะะะะะะะกะขะ

#### **ะัะพะฑัะฐะถะตะฝะธะต ะดััะทะตะน:**
- ๐ ะกะตัะบะฐ ะบะฐััะพัะตะบ ั ะฐะดะฐะฟัะธะฒะฝัะผ ะดะธะทะฐะนะฝะพะผ
- ๐ญ ะะพะดะดะตัะถะบะฐ ัะตะผ: cyberpunk, watchdogs, pixel
- โก ะกะพััะพัะฝะธั: ะทะฐะณััะทะบะฐ, ะพัะธะฑะบะฐ, ะฟัััะพะน ัะฟะธัะพะบ
- ๐ง ะะตะนััะฒะธั: ะฟัะพัะผะพัั, ัะดะฐะปะตะฝะธะต (ัะฐั ะฒ ัะฐะทัะฐะฑะพัะบะต)

#### **ะะฝัะพัะผะฐัะธั ะพ ะดััะณะต:**
- ๐ค ะะฒะฐัะฐั ั ะฟะตัะฒะพะน ะฑัะบะฒะพะน ะธะผะตะฝะธ
- ๐ท ะัะฑะปะธัะฝะพะต ะธะผั ะธ ID (ะฟะตัะฒัะต 8 ัะธะผะฒะพะปะพะฒ)
- ๐ ID ะฐะบะบะฐัะฝัะฐ ะธ P2P ะบะปัั (ัะพะบัะฐัะตะฝะฝะพ)
- ๐ฏ ะะฝะพะฟะบะธ ะดะตะนััะฒะธะน ั ะฐะฝะธะผะฐัะธะตะน

### ๐ ะกะขะะขะะกะขะะะ ะะะะะะะะฆะะ

| ะะพะผะฟะพะฝะตะฝั | ะกัะฐััั | ะคะฐะนะปั |
|-----------|--------|-------|
| **API Layer** | โ ะะฐะฒะตััะตะฝ | `src/api/index.ts` |
| **Frontend UI** | โ ะะฐะฒะตััะตะฝ | `src/pages/friends/ui/FriendsPage.svelte` |
| **Backend Service** | โ ะะฐะฑะพัะฐะตั | `src/local_back/modules/friends_service.ts` |
| **IndexedDB** | โ ะะฐะฑะพัะฐะตั | `src/indexdb/friends/*` |
| **Middleware** | โ ะะฐะฑะพัะฐะตั | `src/local_back/middleware.ts` |
| **Types** | โ ะะพัะพะฒั | `FriendEntity`, `FriendEntityFull` |

### ๐ฏ ะะะะฃะะฌะขะะข

**API ะดะปั ะฟะพะปััะตะฝะธั ะดััะทะตะน ะฟะพะปะฝะพัััั ัะตะฐะปะธะทะพะฒะฐะฝ ะธ ะณะพัะพะฒ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!**

โ ะะฐะฝะฝัะต ะฟะพะปััะฐัััั ะธะท IndexedDB ัะตัะตะท shared worker  
โ ะะฐััะธััะพะฒะบะฐ ะฟัะพะธััะพะดะธั ัะพะปัะบะพ ะฒ ะฑะตะทะพะฟะฐัะฝะพะผ ัะปะพะต local_back  
โ ะคัะพะฝัะตะฝะด ะธัะฟะพะปัะทัะตั ัะดะพะฑะฝัะน API ะธะฝัะตััะตะนั  
โ ะััะธัะตะบัััะฐ ัะพะพัะฒะตัััะฒัะตั ะฟัะธะฝัะธะฟะฐะผ ะฟัะพะตะบัะฐ  
โ UI ะพะฑะฝะพะฒะปะตะฝ ะดะปั ัะฐะฑะพัั ัะตัะตะท API  

---
**ะกะะกะขะะะ ะะะฃะะะ ะะะขะะะะ ะ ะะะขะะะ ะ ะะะะะขะ!** ๐
