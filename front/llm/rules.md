# Правила и указания проекта

## Обязательные правила проекта:

1. **Ограничение изменений**: Не меняй больше 2х файлов за раз до выключения. Выключайся чаще, прося продолжить для экономии токенов.

2. **Размер файлов**: Чем меньше файл тем лучше - что с кодом, что с документацией. Максимум 200 строк на файл.

3. **Структура компонентов**: Для компонентов используй директорию `Widgets`, а не `components`.

4. **Архитектура сервисов**: Большие сервисы разделяй на модули по 100-150 строк. Каждый метод должен иметь четкий возвращаемый тип.

5. **Миграция сервисов**: Новый сервис `createFriendsLibp2pService.ts` заменяет старый `friends_libp2p_service.ts`. Старый файл нужно удалить при следующем запуске.

6. **Стиль кода**: Не меняй кардинально существующий код. Подстраивайся под стиль, чтобы упростить ревью.

7. **Тестирование**: Не запускай тесты, если не просят. Используй только команду `npm run test`.

8. **Единицы измерения**: Используй `rem` как единицу измерения, а не `px`.

9. **Цвета**: Для цветов используй переменные Tailwind: `text-[var(--...)]`.

10. **Язык**: Всегда отвечай на русском языке.

11. **Анализ тестов**: При анализе вывода тестов обращай внимание на слово `failed`.

12. **Решение проблем с установкой**: Если ошибка повторяется, попробуй `npm install` и `npm run test`.

13. **Откат к рабочему состоянию**: Если ошибка не исчезла, используй `git checkout HEAD~` для поиска рабочего состояния. После нахождения проблемы, верни актуальный `llm_prompt` с помощью `git checkout -- front/llm_prompt` и исправь ошибку в актуальной версии.

14. **Демонстрация результата**: Чаще показывай рабочий результат, меньше пиши. Запускай приложение и показывай изменения после каждого значимого изменения. После изменений тем - покажи скриншот интерфейса.

## Новые правила системы тем и CSS:

15. **Система тем**: 
    - Используй только переменные --les-* из themes.css
    - Избегай дублирования CSS файлов тем (один источник истины)
    - Для цветов в Tailwind: `text-[var(--les-accent-primary)]`
    - Не создавай отдельные CSS файлы для тем - все в themes.css

16. **Централизация стилей**:
    - Все переменные цветов только в src/styles/themes.css
    - Удаляй legacy CSS файлы тем при рефакторинге
    - Проверяй imports после удаления файлов
    - Для CSS файлов - максимум 150 строк

17. **Правила рефакторинга**:
    - Перед рефакторингом - проверь все связанные импорты
    - Ищи дублирующую функциональность в проекте
    - Сначала обновляй основной файл, потом удаляй старый
    - После удаления файла - проверь что ничего не сломалось

18. **CSS переменные**:
    - Используй семантические имена: --les-accent-primary, а не --yellow
    - Поддерживай legacy переменные для обратной совместимости
    - Все новые компоненты только с --les-* переменными
    - Проверяй работу в разных темах перед завершением

## Криптографические методы Curve25519

### Рекомендуемые методы для самостоятельного шифрования:

**Для шифрования (лучший выбор):**
- `encrypt_curve25519_verify()` - шифрование С проверкой подписи (безопасно)
- `decrypt_curve25519_verify()` - расшифровка С проверкой подписи

**Для простого шифрования (менее безопасно):**
- `encrypt_curve25519()` - шифрование БЕЗ проверки подписи
- `decrypt_curve25519()` - расшифровка БЕЗ проверки подписи

**Генерация ключей:**
- `generate_keys_curve25519()` - генерация пары ключей
- `generate_keys_curve25519_from_password()` - генерация из пароля

**Цифровые подписи:**
- `generate_keys_ed25519()` - генерация ключей для подписи
- `sign_ed25519()` - создание подписи
- `verify_sign_ed25519()` - проверка подписи

### Правило безопасности:
Всегда используй методы с суффиксом `_verify` для важных данных. Они обеспечивают аутентификацию отправителя и целостность сообщения.
