# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –ò–ò

## –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã:

1. **Deprecated `environmentMatchGlobs`** - —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏–π
2. **–£–ø–∞–≤—à–∏–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã** - —Ä–∞–±–æ—Ç–∞–ª–∏ –≤ jsdom –≤–º–µ—Å—Ç–æ node
3. **–õ–∏—à–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ coverage** - –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ —Ä–µ–ø–æ—Ä—Ç–µ—Ä—ã
4. **TypeScript –æ—à–∏–±–∫–∏** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å projects

### ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```typescript
// vitest.config.ts - –ß–ò–°–¢–ê–Ø –ò –†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø
export default defineConfig({
  plugins: [svelte({ 
    hot: !process.env.VITEST,
    compilerOptions: {
      dev: !process.env.VITEST
    }
  })],
  test: {
    environment: 'jsdom',           // –û—Å–Ω–æ–≤–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è UI —Ç–µ—Å—Ç–æ–≤
    globals: true,                  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    setupFiles: ['./src/tests/setup.ts'],
    coverage: {
      provider: 'v8',              // –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä coverage
      reporter: ['text', 'html'],   // –¢–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ä–µ–ø–æ—Ä—Ç–µ—Ä—ã
      exclude: [                    // –ò—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ coverage
        'node_modules/',
        'src/tests/',
        '**/*.d.ts',
        '**/*.config.*',
        'dist/',
        'build/'
      ]
    }
  },
  define: {
    global: 'globalThis'           // –ü–æ–ª–∏—Ñ–∏–ª–ª –¥–ª—è browser –æ–∫—Ä—É–∂–µ–Ω–∏—è
  },
  resolve: {
    conditions: ['browser']        // –†–µ–∑–æ–ª–≤ –¥–ª—è browser –º–æ–¥—É–ª–µ–π
  }
})
```

### üîß Workspace –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π:

```typescript
// vitest.workspace.ts - –î–õ–Ø –†–ê–ó–î–ï–õ–ï–ù–ò–Ø –û–ö–†–£–ñ–ï–ù–ò–ô
export default defineWorkspace([
  {
    extends: './vitest.config.ts',
    test: {
      include: ['src/**/*.test.{ts,js}', '!src/core/crypt/**/*.test.js'],
      name: 'browser',
      environment: 'jsdom',        // UI —Ç–µ—Å—Ç—ã –≤ jsdom
    }
  },
  {
    test: {
      include: ['src/core/crypt/**/*.test.js'],
      name: 'crypto',
      environment: 'node',         // –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –≤ node
      globals: true,
      setupFiles: ['./src/tests/setup.ts'],
    }
  }
])
```

## üö® –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê –¥–ª—è –ò–ò –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

### 1. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ deprecated —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚ùå `environmentMatchGlobs` - deprecated
- ‚ùå `test.projects` —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `vitest.workspace.ts` –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

### 2. –û–∫—Ä—É–∂–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤:
- **jsdom** - –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ Svelte
- **node** - –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π (libsodium)
- **happy-dom** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ jsdom (–±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –º–µ–Ω–µ–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è)

### 3. Coverage –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ `v8` –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–±—ã—Å—Ç—Ä—ã–π)
- –†–µ–ø–æ—Ä—Ç–µ—Ä—ã: `['text', 'html']` (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–∫–ª—é—á–∞–π—Ç–µ: `node_modules/`, `src/tests/`, `**/*.d.ts`

### 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥:
```json
{
  "test": "vitest",                    // Watch —Ä–µ–∂–∏–º
  "test:run": "vitest run",           // –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
  "test:coverage": "vitest --coverage", // –° –∞–Ω–∞–ª–∏–∑–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è
  "test:ui": "vitest --ui"            // –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
}
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º:

### –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (jsdom vs node)
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ libsodium —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ node
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ setupFiles –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### –ï—Å–ª–∏ TypeScript –æ—à–∏–±–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/// <reference types="vitest/config" />`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã
3. –ù–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ workspace –∏ projects —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

### –ï—Å–ª–∏ coverage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `@vitest/coverage-v8`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ exclude –ø–∞—Ç—Ç–µ—Ä–Ω—ã
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–µ—Å—Ç—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

- ‚úÖ –í—Å–µ 19 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –£–±—Ä–∞–Ω—ã deprecated –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã TypeScript –æ—à–∏–±–∫–∏
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã coverage –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤

## üéØ –î–ª—è –±—É–¥—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. **–ù–ï —Ç—Ä–æ–≥–∞–π—Ç–µ** —Ä–∞–±–æ—á—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑ –≤–µ—Å–∫–æ–π –ø—Ä–∏—á–∏–Ω—ã
2. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥–∞—Ö
3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** –Ω–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ** workspace –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤
